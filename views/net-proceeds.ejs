<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실수령액 계산기 - 부동산계산하기</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">부</div>
            <a href="/" style="text-decoration: none; color: inherit;">부동산계산하기</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/sell" class="back-button">
            ← 집을 팔려고 해요
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">💵</div>
            <h1 class="calculator-title">실수령액 계산기</h1>
            <p class="calculator-subtitle">매도가에서 모든 비용을 제외한 순수익을 계산합니다</p>
        </div>

        <!-- 실수령액 안내 -->
        <div class="info-box">
            <div class="info-title">
                💡 실수령액이란?
            </div>
            <div class="info-content">
                주택 매도 시 실제로 손에 쥐는 금액입니다.
                <br><br>
                <strong>실수령액 = 매도가 - 대출상환 - 양도세 - 중개수수료 - 기타비용</strong>
                <br><br>
                양도소득세, 중개수수료, 대출금 상환, 등기비용 등을 모두 고려하여 
                실제로 받게 되는 금액을 정확히 계산합니다.
            </div>
        </div>

        <!-- 계산 입력 폼 -->
        <div class="calc-section">
            <h2 class="calc-section-title">매도 정보</h2>
            
            <div class="input-group">
                <label class="input-label">매도가 (양도가액)</label>
                <div class="input-wrapper">
                    <input type="text" id="salePrice" class="input-field" placeholder="예: 700000000" inputmode="numeric">
                    <span class="input-suffix">원</span>
                </div>
                <div class="input-helper">실제 매도 계약 금액</div>
            </div>

            <div class="input-group">
                <label class="input-label">당초 취득가 (매수가)</label>
                <div class="input-wrapper">
                    <input type="text" id="purchasePrice" class="input-field" placeholder="예: 500000000" inputmode="numeric">
                    <span class="input-suffix">원</span>
                </div>
                <div class="input-helper">주택을 구매했던 가격</div>
            </div>

            <div class="input-group">
                <label class="input-label">잔존 대출금</label>
                <div class="input-wrapper">
                    <input type="text" id="loanBalance" class="input-field" placeholder="0" inputmode="numeric" value="0">
                    <span class="input-suffix">원</span>
                </div>
                <div class="input-helper">매도 시점 남은 대출금 (있는 경우)</div>
            </div>
        </div>

        <div class="calc-section">
            <h2 class="calc-section-title">양도소득세 정보</h2>
            
            <div class="input-group">
                <label class="input-label">보유 주택 수</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="1" checked>
                        <span class="radio-label">1주택</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="2">
                        <span class="radio-label">2주택</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="3">
                        <span class="radio-label">3주택 이상</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">조정대상지역 여부</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="regulated" value="no" checked>
                        <span class="radio-label">일반지역</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="regulated" value="yes">
                        <span class="radio-label">조정대상지역</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">보유 기간</label>
                <div class="input-wrapper">
                    <input type="text" id="holdingYears" class="input-field" placeholder="예: 5" inputmode="numeric">
                    <span class="input-suffix">년</span>
                </div>
            </div>

            <div class="input-group" id="residenceSection">
                <label class="input-label">거주 기간 (1주택만)</label>
                <div class="input-wrapper">
                    <input type="text" id="residenceYears" class="input-field" placeholder="예: 3" inputmode="numeric">
                    <span class="input-suffix">년</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">필요경비 (취득세, 중개수수료 등)</label>
                <div class="input-wrapper">
                    <input type="text" id="expenses" class="input-field" placeholder="0" inputmode="numeric" value="0">
                    <span class="input-suffix">원</span>
                </div>
                <div class="input-helper">취득 시 발생한 비용 (취득세, 중개수수료, 등기비용 등)</div>
            </div>
        </div>

        <div class="calc-section">
            <h2 class="calc-section-title">매도 비용</h2>
            
            <div class="input-group">
                <label class="input-label">중개수수료 (매도 시)</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="brokerageOption" value="auto" checked>
                        <span class="radio-label">자동 계산 (서울시 기준)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="brokerageOption" value="manual">
                        <span class="radio-label">직접 입력</span>
                    </label>
                </div>
            </div>

            <div class="input-group" id="manualBrokerageSection" style="display: none;">
                <label class="input-label">중개수수료 금액</label>
                <div class="input-wrapper">
                    <input type="text" id="manualBrokerage" class="input-field" placeholder="0" inputmode="numeric">
                    <span class="input-suffix">원</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">기타 매도 비용</label>
                <div class="input-wrapper">
                    <input type="text" id="otherCosts" class="input-field" placeholder="0" inputmode="numeric" value="0">
                    <span class="input-suffix">원</span>
                </div>
                <div class="input-helper">말소등기비용, 이사비용 등</div>
            </div>

            <button class="calc-button" id="calculateButton">
                실수령액 계산하기
            </button>
        </div>

        <!-- 결과 영역 -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">💰 계산 결과</h2>
            
            <div class="result-card total">
                <div class="result-label">실수령액 (최종)</div>
                <div class="result-value" id="netProceeds">0원</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">수입 및 지출 내역</h3>
                <div class="breakdown-item" style="background: rgba(0, 217, 181, 0.1); padding: 12px; border-radius: 8px;">
                    <span class="breakdown-label" style="font-weight: 600; color: var(--secondary);">매도가 (수입)</span>
                    <span class="breakdown-value" style="font-weight: 600; color: var(--secondary);" id="displaySalePrice">0원</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">차감 항목</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">대출 상환 (-)</span>
                    <span class="breakdown-value" id="displayLoanBalance">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">양도소득세 (-)</span>
                    <span class="breakdown-value" id="capitalGainsTax">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">중개수수료 (-)</span>
                    <span class="breakdown-value" id="brokerageFee">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">기타 비용 (-)</span>
                    <span class="breakdown-value" id="displayOtherCosts">0원</span>
                </div>
                <div class="breakdown-item" style="border-top: 2px solid var(--border); padding-top: 12px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700; color: #FF5733;">총 차감액</span>
                    <span class="breakdown-value" style="font-weight: 700; color: #FF5733;" id="totalDeductions">0원</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">양도소득세 상세</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">양도차익</span>
                    <span class="breakdown-value" id="capitalGain">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">장기보유특별공제</span>
                    <span class="breakdown-value" id="longTermDeduction">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">과세표준</span>
                    <span class="breakdown-value" id="taxBase">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">적용 세율</span>
                    <span class="breakdown-value" id="taxRate">0%</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">손익 분석</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">당초 투자금 (취득가)</span>
                    <span class="breakdown-value" id="displayPurchasePrice">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">실수령액</span>
                    <span class="breakdown-value" id="displayNetProceeds">0원</span>
                </div>
                <div class="breakdown-item" style="background: rgba(0, 217, 181, 0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700; color: var(--secondary);">순수익 (실수령액 - 취득가)</span>
                    <span class="breakdown-value" style="font-weight: 700; color: var(--secondary);" id="netProfit">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">수익률</span>
                    <span class="breakdown-value" id="profitRate">0%</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">ℹ️</div>
                <div class="info-text" id="resultInfo"></div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    다시 계산하기
                </button>
                <button class="action-button primary" id="shareButton">
                    결과 공유하기
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM 로드 완료 후 실행
        document.addEventListener('DOMContentLoaded', function() {
            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculateNetProceeds);
            }

            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // 숫자 입력 필드
            ['salePrice', 'purchasePrice', 'loanBalance', 'holdingYears', 'residenceYears', 'expenses', 'manualBrokerage', 'otherCosts'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/[^0-9.]/g, '');
                        e.target.value = value;
                    });
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') calculateNetProceeds();
                    });
                }
            });

            // 주택 수에 따라 거주 기간 표시
            const housingCountInputs = document.querySelectorAll('input[name="housingCount"]');
            housingCountInputs.forEach(input => {
                input.addEventListener('change', function() {
                    const residenceSection = document.getElementById('residenceSection');
                    if (this.value === '1') {
                        residenceSection.style.display = 'block';
                    } else {
                        residenceSection.style.display = 'none';
                    }
                });
            });

            // 중개수수료 옵션
            const brokerageOptions = document.querySelectorAll('input[name="brokerageOption"]');
            brokerageOptions.forEach(input => {
                input.addEventListener('change', function() {
                    const manualSection = document.getElementById('manualBrokerageSection');
                    if (this.value === 'manual') {
                        manualSection.style.display = 'block';
                    } else {
                        manualSection.style.display = 'none';
                    }
                });
            });
        });

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        function formatCurrency(num) {
            return formatNumber(num) + '원';
        }

        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + '억 ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + '만 ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + '원';
        }

        function calculateProgressiveTax(taxBase) {
            let tax = 0;
            if (taxBase <= 14000000) {
                tax = taxBase * 0.06;
            } else if (taxBase <= 50000000) {
                tax = taxBase * 0.15 - 1260000;
            } else if (taxBase <= 88000000) {
                tax = taxBase * 0.24 - 5760000;
            } else if (taxBase <= 150000000) {
                tax = taxBase * 0.35 - 15440000;
            } else if (taxBase <= 300000000) {
                tax = taxBase * 0.38 - 19940000;
            } else if (taxBase <= 500000000) {
                tax = taxBase * 0.40 - 25940000;
            } else if (taxBase <= 1000000000) {
                tax = taxBase * 0.42 - 35940000;
            } else {
                tax = taxBase * 0.45 - 65940000;
            }
            return tax;
        }

        function calculateNetProceeds() {
            const salePrice = parseInt(document.getElementById('salePrice').value) || 0;
            const purchasePrice = parseInt(document.getElementById('purchasePrice').value) || 0;
            const loanBalance = parseInt(document.getElementById('loanBalance').value) || 0;
            const expenses = parseInt(document.getElementById('expenses').value) || 0;
            const otherCosts = parseInt(document.getElementById('otherCosts').value) || 0;
            const housingCount = parseInt(document.querySelector('input[name="housingCount"]:checked').value);
            const regulated = document.querySelector('input[name="regulated"]:checked').value === 'yes';
            const holdingYears = parseFloat(document.getElementById('holdingYears').value) || 0;
            const residenceYears = parseFloat(document.getElementById('residenceYears').value) || 0;
            const brokerageOption = document.querySelector('input[name="brokerageOption"]:checked').value;
            
            if (salePrice === 0 || purchasePrice === 0) {
                alert('매도가와 취득가를 입력해주세요.');
                return;
            }

            // 1. 양도차익
            const capitalGain = salePrice - purchasePrice - expenses;

            // 2. 장기보유특별공제
            let deductionRate = 0;
            if (housingCount === 1) {
                const holdingDeduction = Math.min(holdingYears * 4, 40);
                const residenceDeduction = Math.min(residenceYears * 4, 40);
                deductionRate = Math.min(holdingDeduction + residenceDeduction, 80);
            } else {
                deductionRate = Math.min(holdingYears * 2, 30);
            }
            const longTermDeduction = capitalGain * (deductionRate / 100);

            // 3. 과세표준
            let taxBase = capitalGain - longTermDeduction - 2500000;
            if (taxBase < 0) taxBase = 0;

            // 4. 양도소득세
            let calculatedTax = 0;
            let effectiveRate = '';
            
            if (housingCount === 1) {
                calculatedTax = calculateProgressiveTax(taxBase);
                effectiveRate = '누진세율';
            } else {
                if (regulated) {
                    calculatedTax = taxBase * 0.75;
                    effectiveRate = '75% (중과)';
                } else {
                    calculatedTax = calculateProgressiveTax(taxBase) * 1.3;
                    effectiveRate = '누진 + 30%';
                }
            }

            const localTax = calculatedTax * 0.1;
            const capitalGainsTax = calculatedTax + localTax;

            // 5. 중개수수료
            let brokerageFee = 0;
            if (brokerageOption === 'auto') {
                // 서울시 기준 자동 계산
                if (salePrice < 50000000) {
                    brokerageFee = Math.min(salePrice * 0.006, 250000);
                } else if (salePrice < 200000000) {
                    brokerageFee = Math.min(salePrice * 0.005, 800000);
                } else if (salePrice < 900000000) {
                    brokerageFee = salePrice * 0.004;
                } else if (salePrice < 1200000000) {
                    brokerageFee = salePrice * 0.005;
                } else if (salePrice < 1500000000) {
                    brokerageFee = salePrice * 0.006;
                } else {
                    brokerageFee = salePrice * 0.007;
                }
            } else {
                brokerageFee = parseInt(document.getElementById('manualBrokerage').value) || 0;
            }

            // 6. 총 차감액
            const totalDeductions = loanBalance + capitalGainsTax + brokerageFee + otherCosts;

            // 7. 실수령액
            const netProceeds = salePrice - totalDeductions;

            // 8. 순수익 및 수익률
            const netProfit = netProceeds - purchasePrice;
            const profitRate = purchasePrice > 0 ? (netProfit / purchasePrice * 100) : 0;

            // 결과 메시지
            let resultInfo = '';
            if (netProfit > 0) {
                resultInfo = `${formatKoreanCurrency(netProfit)}의 순수익이 발생합니다. (수익률 ${profitRate.toFixed(1)}%)`;
            } else if (netProfit < 0) {
                resultInfo = `${formatKoreanCurrency(Math.abs(netProfit))}의 손실이 발생합니다. (손실률 ${Math.abs(profitRate).toFixed(1)}%)`;
            } else {
                resultInfo = '손익분기점입니다.';
            }

            // 결과 표시
            document.getElementById('netProceeds').textContent = formatKoreanCurrency(netProceeds);
            document.getElementById('displaySalePrice').textContent = formatCurrency(salePrice);
            document.getElementById('displayLoanBalance').textContent = formatCurrency(loanBalance);
            document.getElementById('capitalGainsTax').textContent = formatCurrency(capitalGainsTax);
            document.getElementById('brokerageFee').textContent = formatCurrency(brokerageFee);
            document.getElementById('displayOtherCosts').textContent = formatCurrency(otherCosts);
            document.getElementById('totalDeductions').textContent = formatCurrency(totalDeductions);
            
            document.getElementById('capitalGain').textContent = formatCurrency(capitalGain);
            document.getElementById('longTermDeduction').textContent = formatCurrency(longTermDeduction) + ` (${deductionRate}%)`;
            document.getElementById('taxBase').textContent = formatCurrency(taxBase);
            document.getElementById('taxRate').textContent = effectiveRate;
            
            document.getElementById('displayPurchasePrice').textContent = formatCurrency(purchasePrice);
            document.getElementById('displayNetProceeds').textContent = formatCurrency(netProceeds);
            document.getElementById('netProfit').textContent = formatCurrency(netProfit);
            document.getElementById('profitRate').textContent = profitRate.toFixed(1) + '%';
            document.getElementById('resultInfo').textContent = resultInfo;

            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetCalculator() {
            document.getElementById('salePrice').value = '';
            document.getElementById('purchasePrice').value = '';
            document.getElementById('loanBalance').value = '0';
            document.getElementById('holdingYears').value = '';
            document.getElementById('residenceYears').value = '';
            document.getElementById('expenses').value = '0';
            document.getElementById('manualBrokerage').value = '';
            document.getElementById('otherCosts').value = '0';
            document.querySelector('input[name="housingCount"][value="1"]').checked = true;
            document.querySelector('input[name="regulated"][value="no"]').checked = true;
            document.querySelector('input[name="brokerageOption"][value="auto"]').checked = true;
            document.getElementById('residenceSection').style.display = 'block';
            document.getElementById('manualBrokerageSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareResult() {
            const netProceeds = document.getElementById('netProceeds').textContent;
            const netProfit = document.getElementById('netProfit').textContent;
            const text = `부동산계산하기에서 실수령액을 계산했어요!\n실수령액: ${netProceeds}\n순수익: ${netProfit}`;
            
            if (navigator.share) {
                navigator.share({
                    title: '실수령액 계산 결과',
                    text: text
                });
            } else {
                alert('결과가 클립보드에 복사되었습니다!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
