<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>중개수수료 계산기 - 부동산계산하기</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">부</div>
            <a href="/" style="text-decoration: none; color: inherit;">부동산계산하기</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/buy" class="back-button">
            ← 집을 사려고 해요
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">🤝</div>
            <h1 class="calculator-title">중개수수료 계산기</h1>
            <p class="calculator-subtitle">부동산 거래 시 내야 할 복비를 계산합니다</p>
        </div>

        <!-- 중개수수료 안내 -->
        <div class="info-box">
            <div class="info-title">
                💡 중개수수료(복비)란?
            </div>
            <div class="info-content">
                부동산 중개업소를 통해 거래할 때 지불하는 수수료입니다. 
                <strong>서울특별시 조례 기준</strong>으로 거래 금액과 주택 유형에 따라 상한요율이 법으로 정해져 있으며, 
                상한 범위 내에서 중개업소와 협의할 수 있습니다.
                <br><br>
                <small>※ 지역별로 요율이 다를 수 있습니다. 본 계산기는 서울시 기준입니다.</small>
            </div>
        </div>

        <!-- 계산 입력 폼 -->
        <div class="calc-section">
            <h2 class="calc-section-title">거래 정보</h2>
            
            <div class="input-group">
                <label class="input-label">거래 유형</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="dealType" value="sale" checked>
                        <span class="radio-label">매매</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="dealType" value="jeonse">
                        <span class="radio-label">전세</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="dealType" value="monthly">
                        <span class="radio-label">월세</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">주택 유형</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="propertyType" value="residential" checked>
                        <span class="radio-label">주택 (아파트, 빌라 등)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="propertyType" value="officetel">
                        <span class="radio-label">오피스텔</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="propertyType" value="land">
                        <span class="radio-label">토지</span>
                    </label>
                </div>
            </div>

            <div id="saleInputs">
                <div class="input-group">
                    <label class="input-label">거래 금액</label>
                    <div class="input-wrapper">
                        <input type="text" id="dealPrice" class="input-field" placeholder="예: 500000000" inputmode="numeric">
                        <span class="input-suffix">원</span>
                    </div>
                    <div class="input-helper">매매가, 전세금 또는 보증금</div>
                </div>
            </div>

            <div id="monthlyInputs" style="display: none;">
                <div class="input-group">
                    <label class="input-label">보증금</label>
                    <div class="input-wrapper">
                        <input type="text" id="deposit" class="input-field" placeholder="예: 50000000" inputmode="numeric">
                        <span class="input-suffix">원</span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">월세</label>
                    <div class="input-wrapper">
                        <input type="text" id="monthlyRent" class="input-field" placeholder="예: 1000000" inputmode="numeric">
                        <span class="input-suffix">원</span>
                    </div>
                    <div class="input-helper">월세 × 100을 보증금에 더해 계산합니다</div>
                </div>
            </div>

            <button class="calc-button" id="calculateButton">
                중개수수료 계산하기
            </button>
        </div>

        <!-- 결과 영역 -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">💰 계산 결과</h2>
            
            <div class="result-card total">
                <div class="result-label">중개수수료 (상한)</div>
                <div class="result-value" id="maxFee">0원</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">수수료 상세</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">거래 금액</span>
                    <span class="breakdown-value" id="displayDealPrice">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">적용 요율</span>
                    <span class="breakdown-value" id="feeRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">중개수수료 상한</span>
                    <span class="breakdown-value" id="displayMaxFee">0원</span>
                </div>
                <div class="breakdown-item" style="border-top: 2px solid var(--border); padding-top: 16px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700;">협의 가능 범위</span>
                    <span class="breakdown-value" style="color: var(--primary); font-weight: 700;" id="negotiableRange">0원 이하</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">ℹ️</div>
                <div class="info-text" id="feeInfo"></div>
            </div>

            <div class="result-info" style="background: rgba(0, 217, 181, 0.05); border-color: rgba(0, 217, 181, 0.2);">
                <div class="info-icon">💡</div>
                <div class="info-text">
                    <strong>절약 팁:</strong> 중개수수료는 상한 범위 내에서 협의 가능합니다. 
                    통상적으로 상한의 70~90% 수준에서 협의하는 경우가 많습니다.
                </div>
            </div>

            <!-- 예상 협의 금액 -->
            <div class="result-breakdown">
                <h3 class="breakdown-title">예상 협의 금액</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">70% 협의 시</span>
                    <span class="breakdown-value" id="fee70">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">80% 협의 시</span>
                    <span class="breakdown-value" id="fee80">0원</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">90% 협의 시</span>
                    <span class="breakdown-value" id="fee90">0원</span>
                </div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    다시 계산하기
                </button>
                <button class="action-button primary" id="shareButton">
                    결과 공유하기
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM 로드 완료 후 실행
        document.addEventListener('DOMContentLoaded', function() {
            // 계산 버튼 이벤트
            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculateBrokerageFee);
            }

            // 리셋 버튼 이벤트
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            // 공유 버튼 이벤트
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // 거래 유형 변경 이벤트
            const dealTypeInputs = document.querySelectorAll('input[name="dealType"]');
            dealTypeInputs.forEach(input => {
                input.addEventListener('change', function() {
                    if (this.value === 'monthly') {
                        document.getElementById('saleInputs').style.display = 'none';
                        document.getElementById('monthlyInputs').style.display = 'block';
                    } else {
                        document.getElementById('saleInputs').style.display = 'block';
                        document.getElementById('monthlyInputs').style.display = 'none';
                    }
                });
            });

            // 숫자 입력 필드 포맷팅
            const numericInputs = ['dealPrice', 'deposit', 'monthlyRent'];
            numericInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/[^0-9]/g, '');
                        e.target.value = value;
                    });

                    // 엔터 키로 계산
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            calculateBrokerageFee();
                        }
                    });
                }
            });
        });

        // 숫자 포맷팅
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        // 원 단위 표시
        function formatCurrency(num) {
            return formatNumber(num) + '원';
        }

        // 억/만 단위 표시
        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + '억 ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + '만 ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + '원';
        }

        // 중개수수료 계산 함수
        function calculateBrokerageFee() {
            const dealType = document.querySelector('input[name="dealType"]:checked').value;
            const propertyType = document.querySelector('input[name="propertyType"]:checked').value;
            
            let dealAmount = 0;
            
            if (dealType === 'monthly') {
                const deposit = parseInt(document.getElementById('deposit').value) || 0;
                const monthlyRent = parseInt(document.getElementById('monthlyRent').value) || 0;
                
                if (deposit === 0 && monthlyRent === 0) {
                    alert('보증금과 월세를 입력해주세요.');
                    return;
                }
                
                // 월세 계산: 보증금 + (월세 × 100)
                // 단, 합산 금액이 5천만원 미만이면 보증금 + (월세 × 70)
                let calculated = deposit + (monthlyRent * 100);
                if (calculated < 50000000) {
                    dealAmount = deposit + (monthlyRent * 70);
                } else {
                    dealAmount = calculated;
                }
            } else {
                dealAmount = parseInt(document.getElementById('dealPrice').value) || 0;
                
                if (dealAmount === 0) {
                    alert('거래 금액을 입력해주세요.');
                    return;
                }
            }

            let feeRate = 0;
            let maxFee = 0;
            let infoMessage = '';

            // 중개수수료율 결정 (서울시 조례 기준)
            if (propertyType === 'residential') {
                // 주택
                if (dealType === 'sale') {
                    // 매매·교환
                    if (dealAmount < 50000000) {
                        feeRate = 0.006; // 0.6%
                        maxFee = dealAmount * feeRate;
                        if (maxFee > 250000) maxFee = 250000;
                        infoMessage = '5천만원 미만: 0.6% (한도 25만원)';
                    } else if (dealAmount < 200000000) {
                        feeRate = 0.005; // 0.5%
                        maxFee = dealAmount * feeRate;
                        if (maxFee > 800000) maxFee = 800000;
                        infoMessage = '5천만원~2억원: 0.5% (한도 80만원)';
                    } else if (dealAmount < 900000000) {
                        feeRate = 0.004; // 0.4%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '2억원~9억원: 0.4%';
                    } else if (dealAmount < 1200000000) {
                        feeRate = 0.005; // 0.5%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '9억원~12억원: 0.5%';
                    } else if (dealAmount < 1500000000) {
                        feeRate = 0.006; // 0.6%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '12억원~15억원: 0.6%';
                    } else {
                        feeRate = 0.007; // 0.7%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '15억원 이상: 0.7%';
                    }
                } else {
                    // 임대차 (전세·월세)
                    if (dealAmount < 50000000) {
                        feeRate = 0.005; // 0.5%
                        maxFee = dealAmount * feeRate;
                        if (maxFee > 200000) maxFee = 200000;
                        infoMessage = '5천만원 미만: 0.5% (한도 20만원)';
                    } else if (dealAmount < 100000000) {
                        feeRate = 0.004; // 0.4%
                        maxFee = dealAmount * feeRate;
                        if (maxFee > 300000) maxFee = 300000;
                        infoMessage = '5천만원~1억원: 0.4% (한도 30만원)';
                    } else if (dealAmount < 600000000) {
                        feeRate = 0.003; // 0.3%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '1억원~6억원: 0.3%';
                    } else if (dealAmount < 1200000000) {
                        feeRate = 0.004; // 0.4%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '6억원~12억원: 0.4%';
                    } else if (dealAmount < 1500000000) {
                        feeRate = 0.005; // 0.5%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '12억원~15억원: 0.5%';
                    } else {
                        feeRate = 0.006; // 0.6%
                        maxFee = dealAmount * feeRate;
                        infoMessage = '15억원 이상: 0.6%';
                    }
                }
            } else if (propertyType === 'officetel') {
                // 오피스텔 (주거용: 전용면적 85㎡ 이하 + 주거시설 완비)
                if (dealType === 'sale') {
                    // 매매·교환
                    feeRate = 0.005; // 0.5%
                    maxFee = dealAmount * feeRate;
                    infoMessage = '오피스텔 매매·교환: 0.5%';
                } else {
                    // 임대차
                    feeRate = 0.004; // 0.4%
                    maxFee = dealAmount * feeRate;
                    infoMessage = '오피스텔 임대차: 0.4%';
                }
            } else {
                // 주택·오피스텔 외 (토지, 상가 등)
                feeRate = 0.009; // 0.9%
                maxFee = dealAmount * feeRate;
                infoMessage = '토지 및 기타 부동산: 0.9%';
            }

            // 예상 협의 금액
            const fee70 = maxFee * 0.7;
            const fee80 = maxFee * 0.8;
            const fee90 = maxFee * 0.9;

            // 결과 표시
            document.getElementById('maxFee').textContent = formatKoreanCurrency(maxFee);
            document.getElementById('displayDealPrice').textContent = formatCurrency(dealAmount);
            document.getElementById('feeRate').textContent = (feeRate * 100).toFixed(1) + '%';
            document.getElementById('displayMaxFee').textContent = formatCurrency(maxFee);
            document.getElementById('negotiableRange').textContent = formatKoreanCurrency(maxFee) + ' 이하';
            document.getElementById('feeInfo').textContent = infoMessage + ' (서울시 조례 기준)';
            
            document.getElementById('fee70').textContent = formatCurrency(fee70);
            document.getElementById('fee80').textContent = formatCurrency(fee80);
            document.getElementById('fee90').textContent = formatCurrency(fee90);

            // 결과 섹션 표시
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 계산기 리셋
        function resetCalculator() {
            document.querySelector('input[name="dealType"][value="sale"]').checked = true;
            document.querySelector('input[name="propertyType"][value="residential"]').checked = true;
            document.getElementById('dealPrice').value = '';
            document.getElementById('deposit').value = '';
            document.getElementById('monthlyRent').value = '';
            document.getElementById('saleInputs').style.display = 'block';
            document.getElementById('monthlyInputs').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 결과 공유
        function shareResult() {
            const maxFee = document.getElementById('maxFee').textContent;
            const feeRate = document.getElementById('feeRate').textContent;
            const text = `부동산계산하기에서 중개수수료를 계산했어요!\n적용 요율: ${feeRate}\n중개수수료 상한: ${maxFee}`;
            
            if (navigator.share) {
                navigator.share({
                    title: '중개수수료 계산 결과',
                    text: text
                });
            } else {
                alert('결과가 클립보드에 복사되었습니다!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
