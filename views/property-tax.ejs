<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¬ì‚°ì„¸ ê³„ì‚°ê¸° - ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ë¶€</div>
            <a href="/" style="text-decoration: none; color: inherit;">ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/hold" class="back-button">
            â† ì§‘ì„ ê°€ì§€ê³  ìˆì–´ìš”
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">ğŸ˜ï¸</div>
            <h1 class="calculator-title">ì¬ì‚°ì„¸ ê³„ì‚°ê¸°</h1>
            <p class="calculator-subtitle">ì£¼íƒ ë³´ìœ  ì‹œ ë§¤ë…„ ë‚´ëŠ” ì¬ì‚°ì„¸ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì¬ì‚°ì„¸ ì•ˆë‚´ -->
        <div class="info-box">
            <div class="info-title">
                ğŸ’¡ ì¬ì‚°ì„¸ë€?
            </div>
            <div class="info-content">
                ì¬ì‚°ì„¸ëŠ” ë¶€ë™ì‚°ì„ ë³´ìœ í•œ ëª¨ë“  ì‚¬ëŒì´ ë‚´ëŠ” ì§€ë°©ì„¸ì…ë‹ˆë‹¤.
                <br><br>
                â€¢ <strong>ê³¼ì„¸ê¸°ì¤€ì¼</strong>: ë§¤ë…„ 6ì›” 1ì¼ (ì´ ë‚  ê¸°ì¤€ ì†Œìœ ìê°€ ë‚©ë¶€)<br>
                â€¢ <strong>ë‚©ë¶€ ì‹œê¸°</strong>: 7ì›” (1~15ì¼), 9ì›” (16~30ì¼) 2íšŒ ë¶„ë‚©<br>
                â€¢ <strong>ê³¼ì„¸í‘œì¤€</strong>: ê³µì‹œê°€ê²© Ã— 60% (ê³µì •ì‹œì¥ê°€ì•¡ë¹„ìœ¨)
            </div>
        </div>

        <!-- ê³„ì‚° ì…ë ¥ í¼ -->
        <div class="calc-section">
            <h2 class="calc-section-title">ì£¼íƒ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ì£¼íƒ ê³µì‹œê°€ê²©</label>
                <div class="input-wrapper">
                    <input type="text" id="publicPrice" class="input-field" placeholder="ì˜ˆ: 600000000" inputmode="numeric">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">êµ­í† êµí†µë¶€ ë¶€ë™ì‚°ê³µì‹œê°€ê²©ì•Œë¦¬ë¯¸ì—ì„œ í™•ì¸ ê°€ëŠ¥</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì£¼íƒ ì¢…ë¥˜</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="houseType" value="house" checked>
                        <span class="radio-label">ì£¼íƒ (ì¼ë°˜)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="houseType" value="apartment">
                        <span class="radio-label">ì•„íŒŒíŠ¸</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="houseType" value="villa">
                        <span class="radio-label">ë¹Œë¼/ì—°ë¦½</span>
                    </label>
                </div>
                <div class="input-helper">ì„¸ìœ¨ì€ ë™ì¼í•˜ë©°, ê°ë©´ í˜œíƒ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
            </div>

            <div class="input-group">
                <label class="input-label">1ì„¸ëŒ€ 1ì£¼íƒ ì—¬ë¶€</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="singleHouse" value="yes">
                        <span class="radio-label">1ì„¸ëŒ€ 1ì£¼íƒ (ê°ë©´ ëŒ€ìƒ)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="singleHouse" value="no" checked>
                        <span class="radio-label">ë‹¤ì£¼íƒ ë˜ëŠ” ë¹„í•´ë‹¹</span>
                    </label>
                </div>
                <div class="input-helper">1ì„¸ëŒ€ 1ì£¼íƒì€ ì¬ì‚°ì„¸ ê°ë©´ í˜œíƒì´ ìˆìŠµë‹ˆë‹¤</div>
            </div>

            <button class="calc-button" id="calculateButton">
                ì¬ì‚°ì„¸ ê³„ì‚°í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">ğŸ’° ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card total">
                <div class="result-label">ì—°ê°„ ì´ ì¬ì‚°ì„¸</div>
                <div class="result-value" id="totalTax">0ì›</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ì„¸ì•¡ ìƒì„¸</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì£¼íƒ ê³µì‹œê°€ê²©</span>
                    <span class="breakdown-value" id="displayPublicPrice">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê³¼ì„¸í‘œì¤€ (ê³µì‹œê°€ Ã— 60%)</span>
                    <span class="breakdown-value" id="taxBase">0ì›</span>
                </div>
                <div class="breakdown-item" style="border-top: 1px solid var(--border); margin-top: 8px; padding-top: 12px;">
                    <span class="breakdown-label">ì¬ì‚°ì„¸ ë³¸ì„¸</span>
                    <span class="breakdown-value" id="baseTax">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë„ì‹œì§€ì—­ë¶„ (ë³¸ì„¸ Ã— 14%)</span>
                    <span class="breakdown-value" id="urbanTax">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì§€ë°©êµìœ¡ì„¸ (ë³¸ì„¸ Ã— 20%)</span>
                    <span class="breakdown-value" id="educationTax">0ì›</span>
                </div>
                <div class="breakdown-item" id="deductionItem" style="display: none; background: rgba(0, 217, 181, 0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="color: var(--secondary); font-weight: 600;">1ì„¸ëŒ€ 1ì£¼íƒ ê°ë©´ (-)</span>
                    <span class="breakdown-value" style="color: var(--secondary); font-weight: 600;" id="deduction">0ì›</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ë‚©ë¶€ ì¼ì •</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">7ì›” ë‚©ë¶€ë¶„ (1~15ì¼ ì£¼íƒ)</span>
                    <span class="breakdown-value" id="julyPayment">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">9ì›” ë‚©ë¶€ë¶„ (16~30ì¼ ì£¼íƒ)</span>
                    <span class="breakdown-value" id="septPayment">0ì›</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">â„¹ï¸</div>
                <div class="info-text" id="taxInfo"></div>
            </div>

            <div class="result-info" style="background: rgba(0, 217, 181, 0.05); border-color: rgba(0, 217, 181, 0.2);">
                <div class="info-icon">ğŸ’¡</div>
                <div class="info-text">
                    <strong>ì¬ì‚°ì„¸ ì ˆì„¸ íŒ</strong><br>
                    â€¢ 1ì„¸ëŒ€ 1ì£¼íƒ: ê³µì‹œê°€ 6ì–µ ì´í•˜ ì‹œ ìµœëŒ€ 10ë§Œì› ê°ë©´<br>
                    â€¢ ê³ ë ¹ì ê°ë©´: ë§Œ 60ì„¸ ì´ìƒ 20%, ë§Œ 65ì„¸ ì´ìƒ 30%<br>
                    â€¢ ì¥ê¸°ë³´ìœ  ê³µì œëŠ” ì¬ì‚°ì„¸ê°€ ì•„ë‹Œ ì–‘ë„ì„¸ì— ì ìš©ë©ë‹ˆë‹¤
                </div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                </button>
                <button class="action-button primary" id="shareButton">
                    ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ê³„ì‚° ë²„íŠ¼ ì´ë²¤íŠ¸
            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculatePropertyTax);
            }

            // ë¦¬ì…‹ ë²„íŠ¼
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            // ê³µìœ  ë²„íŠ¼
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // ìˆ«ì ì…ë ¥ í•„ë“œ í¬ë§·íŒ…
            const publicPriceInput = document.getElementById('publicPrice');
            if (publicPriceInput) {
                publicPriceInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    e.target.value = value;
                });

                publicPriceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculatePropertyTax();
                    }
                });
            }
        });

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        function formatCurrency(num) {
            return formatNumber(num) + 'ì›';
        }

        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + 'ì–µ ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + 'ë§Œ ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + 'ì›';
        }

        // ì¬ì‚°ì„¸ ê³„ì‚° í•¨ìˆ˜
        function calculatePropertyTax() {
            const publicPrice = parseInt(document.getElementById('publicPrice').value) || 0;
            
            if (publicPrice === 0) {
                alert('ì£¼íƒ ê³µì‹œê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const houseType = document.querySelector('input[name="houseType"]:checked').value;
            const singleHouse = document.querySelector('input[name="singleHouse"]:checked').value === 'yes';

            // 1. ê³¼ì„¸í‘œì¤€ ê³„ì‚° (ê³µì‹œê°€ê²© Ã— 60%)
            const taxBase = publicPrice * 0.6;

            // 2. ì¬ì‚°ì„¸ ë³¸ì„¸ ê³„ì‚° (ëˆ„ì§„ì„¸ìœ¨)
            let baseTax = 0;
            let taxRate = 0;
            let infoMessage = '';

            if (taxBase <= 60000000) {
                // 6ì²œë§Œì› ì´í•˜: 0.1%
                baseTax = taxBase * 0.001;
                taxRate = 0.1;
                infoMessage = 'ê³¼ì„¸í‘œì¤€ 6ì²œë§Œì› ì´í•˜: 0.1% ì„¸ìœ¨ ì ìš©';
            } else if (taxBase <= 150000000) {
                // 6ì²œ~1.5ì–µì›: 0.15%
                baseTax = taxBase * 0.0015 - 30000;
                taxRate = 0.15;
                infoMessage = 'ê³¼ì„¸í‘œì¤€ 6ì²œë§Œì›~1.5ì–µì›: 0.15% ì„¸ìœ¨ ì ìš©';
            } else if (taxBase <= 300000000) {
                // 1.5ì–µ~3ì–µì›: 0.25%
                baseTax = taxBase * 0.0025 - 180000;
                taxRate = 0.25;
                infoMessage = 'ê³¼ì„¸í‘œì¤€ 1.5ì–µ~3ì–µì›: 0.25% ì„¸ìœ¨ ì ìš©';
            } else {
                // 3ì–µì› ì´ˆê³¼: 0.4%
                baseTax = taxBase * 0.004 - 630000;
                taxRate = 0.4;
                infoMessage = 'ê³¼ì„¸í‘œì¤€ 3ì–µì› ì´ˆê³¼: 0.4% ì„¸ìœ¨ ì ìš©';
            }

            // 3. ë¶€ê°€ì„¸ ê³„ì‚°
            const urbanTax = baseTax * 0.14; // ë„ì‹œì§€ì—­ë¶„ 14%
            const educationTax = baseTax * 0.2; // ì§€ë°©êµìœ¡ì„¸ 20%

            // 4. 1ì„¸ëŒ€ 1ì£¼íƒ ê°ë©´
            let deduction = 0;
            if (singleHouse && publicPrice <= 600000000) {
                // ê³µì‹œê°€ 6ì–µ ì´í•˜ 1ì„¸ëŒ€ 1ì£¼íƒ ê°ë©´
                if (publicPrice <= 300000000) {
                    // 3ì–µ ì´í•˜: ì „ì•¡ì˜ 50% ê°ë©´
                    deduction = (baseTax + urbanTax + educationTax) * 0.5;
                    if (deduction > 100000) deduction = 100000;
                    infoMessage += ' (1ì„¸ëŒ€ 1ì£¼íƒ ê°ë©´ ì ìš©: ìµœëŒ€ 10ë§Œì›)';
                } else {
                    // 3ì–µ~6ì–µ: ê°ë©´ì•¡ ì ì§„ì  ê°ì†Œ
                    const baseDeduction = (baseTax + urbanTax + educationTax) * 0.5;
                    const reductionRate = (publicPrice - 300000000) / 300000000;
                    deduction = baseDeduction * (1 - reductionRate);
                    if (deduction > 100000) deduction = 100000;
                    infoMessage += ' (1ì„¸ëŒ€ 1ì£¼íƒ ê°ë©´ ì ìš©)';
                }
            }

            // 5. ì´ ì¬ì‚°ì„¸ ê³„ì‚°
            const totalBeforeDeduction = baseTax + urbanTax + educationTax;
            const totalTax = totalBeforeDeduction - deduction;

            // 6. ë‚©ë¶€ ì¼ì • (7ì›”, 9ì›” ë¶„ë‚©)
            const julyPayment = totalTax / 2;
            const septPayment = totalTax / 2;

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('totalTax').textContent = formatKoreanCurrency(totalTax);
            document.getElementById('displayPublicPrice').textContent = formatCurrency(publicPrice);
            document.getElementById('taxBase').textContent = formatCurrency(taxBase);
            document.getElementById('baseTax').textContent = formatCurrency(baseTax);
            document.getElementById('urbanTax').textContent = formatCurrency(urbanTax);
            document.getElementById('educationTax').textContent = formatCurrency(educationTax);
            document.getElementById('julyPayment').textContent = formatCurrency(julyPayment);
            document.getElementById('septPayment').textContent = formatCurrency(septPayment);
            document.getElementById('taxInfo').textContent = infoMessage;

            // ê°ë©´ í•­ëª© í‘œì‹œ/ìˆ¨ê¹€
            const deductionItem = document.getElementById('deductionItem');
            if (deduction > 0) {
                deductionItem.style.display = 'flex';
                document.getElementById('deduction').textContent = formatCurrency(deduction);
            } else {
                deductionItem.style.display = 'none';
            }

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ê³„ì‚°ê¸° ë¦¬ì…‹
        function resetCalculator() {
            document.getElementById('publicPrice').value = '';
            document.querySelector('input[name="houseType"][value="house"]').checked = true;
            document.querySelector('input[name="singleHouse"][value="no"]').checked = true;
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ê²°ê³¼ ê³µìœ 
        function shareResult() {
            const totalTax = document.getElementById('totalTax').textContent;
            const julyPayment = document.getElementById('julyPayment').textContent;
            const text = `ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°ì—ì„œ ì¬ì‚°ì„¸ë¥¼ ê³„ì‚°í–ˆì–´ìš”!\nì—°ê°„ ì´ ì¬ì‚°ì„¸: ${totalTax}\n7ì›” ë‚©ë¶€ì•¡: ${julyPayment}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ì¬ì‚°ì„¸ ê³„ì‚° ê²°ê³¼',
                    text: text
                });
            } else {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
