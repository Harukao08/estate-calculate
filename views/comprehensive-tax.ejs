<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…í•©ë¶€ë™ì‚°ì„¸ ê³„ì‚°ê¸° - ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ë¶€</div>
            <a href="/" style="text-decoration: none; color: inherit;">ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/hold" class="back-button">
            â† ì§‘ì„ ê°€ì§€ê³  ìˆì–´ìš”
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">ğŸ“Š</div>
            <h1 class="calculator-title">ì¢…í•©ë¶€ë™ì‚°ì„¸ ê³„ì‚°ê¸°</h1>
            <p class="calculator-subtitle">ê³ ê°€ ì£¼íƒ ë³´ìœ  ì‹œ ì¶”ê°€ ì„¸ê¸ˆì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì¢…ë¶€ì„¸ ì•ˆë‚´ -->
        <div class="info-box">
            <div class="info-title">
                ğŸ’¡ ì¢…í•©ë¶€ë™ì‚°ì„¸(ì¢…ë¶€ì„¸)ë€?
            </div>
            <div class="info-content">
                ì¢…ë¶€ì„¸ëŠ” ê³ ê°€ ì£¼íƒì„ ë³´ìœ í•œ ì‚¬ëŒì—ê²Œ ë¶€ê³¼ë˜ëŠ” êµ­ì„¸ì…ë‹ˆë‹¤.
                <br><br>
                â€¢ <strong>ê³¼ì„¸ê¸°ì¤€ì¼</strong>: ë§¤ë…„ 6ì›” 1ì¼<br>
                â€¢ <strong>ë‚©ë¶€ ì‹œê¸°</strong>: 12ì›” 1ì¼~15ì¼<br>
                â€¢ <strong>ê³¼ì„¸ ëŒ€ìƒ</strong>: ì£¼íƒ ê³µì‹œê°€ê²© í•©ê³„ê°€ ê¸°ì¤€ê¸ˆì•¡ ì´ˆê³¼ ì‹œ<br>
                &nbsp;&nbsp;- 1ì£¼íƒì: 12ì–µì› ì´ˆê³¼<br>
                &nbsp;&nbsp;- 2ì£¼íƒì: 9ì–µì› ì´ˆê³¼<br>
                &nbsp;&nbsp;- 3ì£¼íƒ ì´ìƒ: 6ì–µì› ì´ˆê³¼
            </div>
        </div>

        <!-- ê³„ì‚° ì…ë ¥ í¼ -->
        <div class="calc-section">
            <h2 class="calc-section-title">ì£¼íƒ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ë³´ìœ  ì£¼íƒ ìˆ˜</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="1" checked>
                        <span class="radio-label">1ì£¼íƒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="2">
                        <span class="radio-label">2ì£¼íƒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="3">
                        <span class="radio-label">3ì£¼íƒ ì´ìƒ</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ì£¼íƒ ê³µì‹œê°€ê²© ì´í•©</label>
                <div class="input-wrapper">
                    <input type="text" id="totalPublicPrice" class="input-field" placeholder="ì˜ˆ: 1500000000" inputmode="numeric">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">ë³´ìœ í•œ ëª¨ë“  ì£¼íƒì˜ ê³µì‹œê°€ê²© í•©ê³„</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì¡°ì •ëŒ€ìƒì§€ì—­ ì£¼íƒ ë³´ìœ  ì—¬ë¶€</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="regulated" value="no" checked>
                        <span class="radio-label">ì—†ìŒ (ì¼ë°˜ì§€ì—­ë§Œ)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="regulated" value="yes">
                        <span class="radio-label">ìˆìŒ (ì¡°ì •ì§€ì—­ í¬í•¨)</span>
                    </label>
                </div>
                <div class="input-helper">ì¡°ì •ì§€ì—­ 2ì£¼íƒ ì´ìƒ ì‹œ ì¤‘ê³¼ì„¸ìœ¨ ì ìš©</div>
            </div>

            <div class="input-group">
                <label class="input-label">ê³ ë ¹ì ì—¬ë¶€ (ë§Œ 60ì„¸ ì´ìƒ)</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="elderly" value="no" checked>
                        <span class="radio-label">í•´ë‹¹ ì—†ìŒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="elderly" value="60">
                        <span class="radio-label">ë§Œ 60~64ì„¸ (20% ê³µì œ)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="elderly" value="65">
                        <span class="radio-label">ë§Œ 65ì„¸ ì´ìƒ (30% ê³µì œ)</span>
                    </label>
                </div>
                <div class="input-helper">1ì£¼íƒì ê³ ë ¹ì ê³µì œ (5ë…„ ì´ìƒ ë³´ìœ  ì‹œ)</div>
            </div>

            <button class="calc-button" id="calculateButton">
                ì¢…ë¶€ì„¸ ê³„ì‚°í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">ğŸ’° ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card total">
                <div class="result-label">ì´ ì¢…í•©ë¶€ë™ì‚°ì„¸</div>
                <div class="result-value" id="totalTax">0ì›</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ì¢…ë¶€ì„¸ ê³„ì‚° ê³¼ì •</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì£¼íƒ ê³µì‹œê°€ê²© ì´í•©</span>
                    <span class="breakdown-value" id="displayTotalPrice">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê¸°ë³¸ê³µì œ</span>
                    <span class="breakdown-value" id="basicDeduction">0ì›</span>
                </div>
                <div class="breakdown-item" style="background: rgba(0, 102, 255, 0.05); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 600;">ê³¼ì„¸í‘œì¤€</span>
                    <span class="breakdown-value" style="font-weight: 600; color: var(--primary);" id="taxBase">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì ìš© ì„¸ìœ¨</span>
                    <span class="breakdown-value" id="taxRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì¢…ë¶€ì„¸ ë³¸ì„¸</span>
                    <span class="breakdown-value" id="baseTax">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë†ì–´ì´ŒíŠ¹ë³„ì„¸ (ë³¸ì„¸ Ã— 20%)</span>
                    <span class="breakdown-value" id="ruralTax">0ì›</span>
                </div>
                <div class="breakdown-item" id="elderlyDeductionItem" style="display: none; background: rgba(0, 217, 181, 0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="color: var(--secondary); font-weight: 600;">ê³ ë ¹ì ê³µì œ (-)</span>
                    <span class="breakdown-value" style="color: var(--secondary); font-weight: 600;" id="elderlyDeduction">0ì›</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">â„¹ï¸</div>
                <div class="info-text" id="taxInfo"></div>
            </div>

            <div class="result-info" style="background: rgba(255, 87, 51, 0.05); border-color: rgba(255, 87, 51, 0.2);" id="warningBox">
                <div class="info-icon">âš ï¸</div>
                <div class="info-text" id="warningText"></div>
            </div>

            <div class="result-info" style="background: rgba(0, 217, 181, 0.05); border-color: rgba(0, 217, 181, 0.2);">
                <div class="info-icon">ğŸ“…</div>
                <div class="info-text">
                    <strong>ë‚©ë¶€ ì¼ì •</strong><br>
                    â€¢ ë‚©ë¶€ ê¸°ê°„: 12ì›” 1ì¼ ~ 12ì›” 15ì¼<br>
                    â€¢ ë¶„ë‚© ê°€ëŠ¥: ë‚©ë¶€ ì„¸ì•¡ 250ë§Œì› ì´ˆê³¼ ì‹œ 50% ë¶„ë‚© ê°€ëŠ¥ (6ê°œì›” í›„)
                </div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                </button>
                <button class="action-button primary" id="shareButton">
                    ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ê³„ì‚° ë²„íŠ¼ ì´ë²¤íŠ¸
            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculateComprehensiveTax);
            }

            // ë¦¬ì…‹ ë²„íŠ¼
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            // ê³µìœ  ë²„íŠ¼
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // ìˆ«ì ì…ë ¥ í•„ë“œ í¬ë§·íŒ…
            const totalPublicPriceInput = document.getElementById('totalPublicPrice');
            if (totalPublicPriceInput) {
                totalPublicPriceInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    e.target.value = value;
                });

                totalPublicPriceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculateComprehensiveTax();
                    }
                });
            }
        });

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        function formatCurrency(num) {
            return formatNumber(num) + 'ì›';
        }

        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + 'ì–µ ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + 'ë§Œ ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + 'ì›';
        }

        // ì¢…í•©ë¶€ë™ì‚°ì„¸ ê³„ì‚° í•¨ìˆ˜
        function calculateComprehensiveTax() {
            const totalPublicPrice = parseInt(document.getElementById('totalPublicPrice').value) || 0;
            
            if (totalPublicPrice === 0) {
                alert('ì£¼íƒ ê³µì‹œê°€ê²© ì´í•©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const housingCount = parseInt(document.querySelector('input[name="housingCount"]:checked').value);
            const regulated = document.querySelector('input[name="regulated"]:checked').value === 'yes';
            const elderly = document.querySelector('input[name="elderly"]:checked').value;

            // 1. ê¸°ë³¸ê³µì œ ê²°ì •
            let basicDeduction = 0;
            let infoMessage = '';
            let warningMessage = '';

            if (housingCount === 1) {
                basicDeduction = 1200000000; // 12ì–µ
                infoMessage = '1ì£¼íƒì ê¸°ë³¸ê³µì œ 12ì–µì› ì ìš©';
            } else if (housingCount === 2) {
                basicDeduction = 900000000; // 9ì–µ
                infoMessage = '2ì£¼íƒì ê¸°ë³¸ê³µì œ 9ì–µì› ì ìš©';
            } else {
                basicDeduction = 600000000; // 6ì–µ
                infoMessage = '3ì£¼íƒ ì´ìƒ ê¸°ë³¸ê³µì œ 6ì–µì› ì ìš©';
            }

            // 2. ê³¼ì„¸í‘œì¤€ ê³„ì‚°
            const taxableAmount = totalPublicPrice - basicDeduction;

            if (taxableAmount <= 0) {
                // ì¢…ë¶€ì„¸ ëŒ€ìƒ ì•„ë‹˜
                document.getElementById('totalTax').textContent = '0ì›';
                document.getElementById('displayTotalPrice').textContent = formatCurrency(totalPublicPrice);
                document.getElementById('basicDeduction').textContent = formatCurrency(basicDeduction);
                document.getElementById('taxBase').textContent = '0ì›';
                document.getElementById('taxRate').textContent = '-';
                document.getElementById('baseTax').textContent = '0ì›';
                document.getElementById('ruralTax').textContent = '0ì›';
                document.getElementById('taxInfo').textContent = 'ì£¼íƒ ê³µì‹œê°€ê²© í•©ê³„ê°€ ì¢…ë¶€ì„¸ ê³¼ì„¸ ê¸°ì¤€ ë¯¸ë§Œì…ë‹ˆë‹¤. ì¢…ë¶€ì„¸ê°€ ë¶€ê³¼ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                document.getElementById('elderlyDeductionItem').style.display = 'none';
                document.getElementById('warningBox').style.display = 'none';
                
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                return;
            }

            // 3. ì¢…ë¶€ì„¸ ë³¸ì„¸ ê³„ì‚° (ëˆ„ì§„ì„¸ìœ¨)
            let baseTax = 0;
            let effectiveRate = '';

            if (housingCount === 1) {
                // 1ì£¼íƒì ì„¸ìœ¨
                if (taxableAmount <= 200000000) {
                    baseTax = taxableAmount * 0.006; // 0.6%
                    effectiveRate = '0.6%';
                } else if (taxableAmount <= 400000000) {
                    baseTax = taxableAmount * 0.008 - 400000;
                    effectiveRate = '0.8%';
                } else if (taxableAmount <= 600000000) {
                    baseTax = taxableAmount * 0.012 - 2000000;
                    effectiveRate = '1.2%';
                } else if (taxableAmount <= 1200000000) {
                    baseTax = taxableAmount * 0.014 - 3200000;
                    effectiveRate = '1.4%';
                } else {
                    baseTax = taxableAmount * 0.020 - 10400000;
                    effectiveRate = '2.0%';
                }
            } else {
                // 2ì£¼íƒ ì´ìƒ
                if (regulated) {
                    // ì¡°ì •ì§€ì—­ ì¤‘ê³¼
                    if (taxableAmount <= 200000000) {
                        baseTax = taxableAmount * 0.012; // 1.2%
                        effectiveRate = '1.2% (ì¤‘ê³¼)';
                    } else if (taxableAmount <= 400000000) {
                        baseTax = taxableAmount * 0.016 - 800000;
                        effectiveRate = '1.6% (ì¤‘ê³¼)';
                    } else if (taxableAmount <= 600000000) {
                        baseTax = taxableAmount * 0.024 - 4000000;
                        effectiveRate = '2.4% (ì¤‘ê³¼)';
                    } else if (taxableAmount <= 1200000000) {
                        baseTax = taxableAmount * 0.030 - 7600000;
                        effectiveRate = '3.0% (ì¤‘ê³¼)';
                    } else {
                        baseTax = taxableAmount * 0.050 - 31600000;
                        effectiveRate = '5.0% (ì¤‘ê³¼)';
                    }
                    warningMessage = 'ì¡°ì •ëŒ€ìƒì§€ì—­ 2ì£¼íƒ ì´ìƒ ë³´ìœ ë¡œ ì¢…ë¶€ì„¸ ì¤‘ê³¼ì„¸ìœ¨ì´ ì ìš©ë©ë‹ˆë‹¤.';
                } else {
                    // ì¼ë°˜ì§€ì—­
                    if (taxableAmount <= 200000000) {
                        baseTax = taxableAmount * 0.008; // 0.8%
                        effectiveRate = '0.8%';
                    } else if (taxableAmount <= 400000000) {
                        baseTax = taxableAmount * 0.012 - 800000;
                        effectiveRate = '1.2%';
                    } else if (taxableAmount <= 600000000) {
                        baseTax = taxableAmount * 0.020 - 4000000;
                        effectiveRate = '2.0%';
                    } else if (taxableAmount <= 1200000000) {
                        baseTax = taxableAmount * 0.025 - 7000000;
                        effectiveRate = '2.5%';
                    } else {
                        baseTax = taxableAmount * 0.040 - 25000000;
                        effectiveRate = '4.0%';
                    }
                }
            }

            // 4. ë†ì–´ì´ŒíŠ¹ë³„ì„¸ (ë³¸ì„¸ì˜ 20%)
            const ruralTax = baseTax * 0.2;

            // 5. ê³ ë ¹ì ê³µì œ (1ì£¼íƒìë§Œ í•´ë‹¹)
            let elderlyDeductionAmount = 0;
            if (housingCount === 1 && elderly !== 'no') {
                const totalBeforeDeduction = baseTax + ruralTax;
                if (elderly === '60') {
                    elderlyDeductionAmount = totalBeforeDeduction * 0.2; // 20%
                    infoMessage += ' / ë§Œ 60ì„¸ ì´ìƒ 20% ê³µì œ ì ìš©';
                } else if (elderly === '65') {
                    elderlyDeductionAmount = totalBeforeDeduction * 0.3; // 30%
                    infoMessage += ' / ë§Œ 65ì„¸ ì´ìƒ 30% ê³µì œ ì ìš©';
                }
            }

            // 6. ì´ ì¢…ë¶€ì„¸
            const totalTax = baseTax + ruralTax - elderlyDeductionAmount;

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('totalTax').textContent = formatKoreanCurrency(totalTax);
            document.getElementById('displayTotalPrice').textContent = formatCurrency(totalPublicPrice);
            document.getElementById('basicDeduction').textContent = formatCurrency(basicDeduction);
            document.getElementById('taxBase').textContent = formatCurrency(taxableAmount);
            document.getElementById('taxRate').textContent = effectiveRate;
            document.getElementById('baseTax').textContent = formatCurrency(baseTax);
            document.getElementById('ruralTax').textContent = formatCurrency(ruralTax);
            document.getElementById('taxInfo').textContent = infoMessage;

            // ê³ ë ¹ì ê³µì œ í‘œì‹œ
            const elderlyDeductionItem = document.getElementById('elderlyDeductionItem');
            if (elderlyDeductionAmount > 0) {
                elderlyDeductionItem.style.display = 'flex';
                document.getElementById('elderlyDeduction').textContent = formatCurrency(elderlyDeductionAmount);
            } else {
                elderlyDeductionItem.style.display = 'none';
            }

            // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
            const warningBox = document.getElementById('warningBox');
            if (warningMessage) {
                warningBox.style.display = 'block';
                document.getElementById('warningText').textContent = warningMessage;
            } else {
                warningBox.style.display = 'none';
            }

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ê³„ì‚°ê¸° ë¦¬ì…‹
        function resetCalculator() {
            document.getElementById('totalPublicPrice').value = '';
            document.querySelector('input[name="housingCount"][value="1"]').checked = true;
            document.querySelector('input[name="regulated"][value="no"]').checked = true;
            document.querySelector('input[name="elderly"][value="no"]').checked = true;
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ê²°ê³¼ ê³µìœ 
        function shareResult() {
            const totalTax = document.getElementById('totalTax').textContent;
            const text = `ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°ì—ì„œ ì¢…í•©ë¶€ë™ì‚°ì„¸ë¥¼ ê³„ì‚°í–ˆì–´ìš”!\nì´ ì¢…ë¶€ì„¸: ${totalTax}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ì¢…ë¶€ì„¸ ê³„ì‚° ê²°ê³¼',
                    text: text
                });
            } else {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
