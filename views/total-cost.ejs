<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ êµ¬ë§¤ë¹„ìš© ê³„ì‚°ê¸° - ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ë¶€</div>
            <a href="/" style="text-decoration: none; color: inherit;">ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/buy" class="back-button">
            â† ì§‘ì„ ì‚¬ë ¤ê³  í•´ìš”
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">ğŸ§®</div>
            <h1 class="calculator-title">ì´ êµ¬ë§¤ë¹„ìš© ê³„ì‚°ê¸°</h1>
            <p class="calculator-subtitle">ì§‘ êµ¬ë§¤ì— í•„ìš”í•œ ëª¨ë“  ë¹„ìš©ì„ í•œ ë²ˆì— ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì´ë¹„ìš© ì•ˆë‚´ -->
        <div class="info-box">
            <div class="info-title">
                ğŸ’¡ ì§‘ êµ¬ë§¤ ì‹œ í•„ìš”í•œ ì´ ë¹„ìš©
            </div>
            <div class="info-content">
                ì§‘ì„ ì‚´ ë•ŒëŠ” <strong>ë§¤ë§¤ê°€</strong> ì™¸ì—ë„ <strong>ì·¨ë“ì„¸</strong>, <strong>ì¤‘ê°œìˆ˜ìˆ˜ë£Œ</strong>, <strong>ë“±ê¸°ë¹„ìš©</strong> ë“± 
                ë‹¤ì–‘í•œ ë¶€ëŒ€ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤. ì´ ê³„ì‚°ê¸°ë¡œ ì´ êµ¬ë§¤ë¹„ìš©ì„ ë¯¸ë¦¬ íŒŒì•…í•˜ì„¸ìš”.
                <br><br>
                <small>â€» ëŒ€ì¶œì„ ë°›ëŠ” ê²½ìš° ëŒ€ì¶œ ê´€ë ¨ ë¹„ìš©ì€ ë³„ë„ì…ë‹ˆë‹¤.</small>
            </div>
        </div>

        <!-- ê³„ì‚° ì…ë ¥ í¼ -->
        <div class="calc-section">
            <h2 class="calc-section-title">ì£¼íƒ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ë§¤ë§¤ê°€ê²©</label>
                <div class="input-wrapper">
                    <input type="text" id="salePrice" class="input-field" placeholder="ì˜ˆ: 500000000" inputmode="numeric">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">ì‹¤ì œ ë§¤ë§¤ ê±°ë˜ê°€ê²©</div>
            </div>

            <div class="input-group">
                <label class="input-label">ë³´ìœ  ì£¼íƒ ìˆ˜ (êµ¬ë§¤ í›„ ê¸°ì¤€)</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="0" checked>
                        <span class="radio-label">ë¬´ì£¼íƒ (ìƒì• ìµœì´ˆ)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="1">
                        <span class="radio-label">1ì£¼íƒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="2">
                        <span class="radio-label">2ì£¼íƒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="3">
                        <span class="radio-label">3ì£¼íƒ ì´ìƒ</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ì£¼íƒ ì†Œì¬ì§€</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="regulated" value="yes" checked>
                        <span class="radio-label">ì¡°ì •ëŒ€ìƒì§€ì—­</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="regulated" value="no">
                        <span class="radio-label">ì¼ë°˜ì§€ì—­</span>
                    </label>
                </div>
            </div>

            <button class="calc-button" id="calculateButton">
                ì´ êµ¬ë§¤ë¹„ìš© ê³„ì‚°í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">ğŸ’° ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card total">
                <div class="result-label">ì´ êµ¬ë§¤ë¹„ìš© (í˜„ê¸ˆ í•„ìš”ì•¡)</div>
                <div class="result-value" id="totalCost">0ì›</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ë¹„ìš© ìƒì„¸ ë‚´ì—­</h3>
                <div class="breakdown-item" style="background: rgba(0, 102, 255, 0.05); padding: 16px; margin-bottom: 12px; border-radius: 8px;">
                    <span class="breakdown-label" style="font-weight: 700; font-size: 16px;">ë§¤ë§¤ê°€ê²©</span>
                    <span class="breakdown-value" style="font-weight: 700; font-size: 16px; color: var(--primary);" id="displaySalePrice">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì·¨ë“ì„¸ (ì§€ë°©êµìœ¡ì„¸Â·ë†íŠ¹ì„¸ í¬í•¨)</span>
                    <span class="breakdown-value" id="acquisitionTax">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì¤‘ê°œìˆ˜ìˆ˜ë£Œ (ìƒí•œ)</span>
                    <span class="breakdown-value" id="brokerageFee">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë“±ê¸°ë¹„ìš© (ì„¸ê¸ˆÂ·ìˆ˜ìˆ˜ë£Œ í¬í•¨)</span>
                    <span class="breakdown-value" id="registrationFee">0ì›</span>
                </div>
                <div class="breakdown-item" style="border-top: 2px solid var(--border); padding-top: 16px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700;">ë¶€ëŒ€ë¹„ìš© í•©ê³„</span>
                    <span class="breakdown-value" style="color: var(--primary); font-weight: 700;" id="additionalCost">0ì›</span>
                </div>
            </div>

            <!-- ë¹„ìœ¨ ë¶„ì„ -->
            <div class="result-breakdown">
                <h3 class="breakdown-title">ë¹„ìš© ë¹„ìœ¨ ë¶„ì„</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë§¤ë§¤ê°€ ëŒ€ë¹„ ë¶€ëŒ€ë¹„ìš© ë¹„ìœ¨</span>
                    <span class="breakdown-value" id="costRatio">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë¶€ëŒ€ë¹„ìš© ì¤‘ ì·¨ë“ì„¸ ë¹„ì¤‘</span>
                    <span class="breakdown-value" id="taxRatio">0%</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">â„¹ï¸</div>
                <div class="info-text" id="costInfo"></div>
            </div>

            <!-- ëŒ€ì¶œ ê³ ë ¤ ì‹œ ì•ˆë‚´ -->
            <div class="result-info" style="background: rgba(0, 217, 181, 0.05); border-color: rgba(0, 217, 181, 0.2);">
                <div class="info-icon">ğŸ’¡</div>
                <div class="info-text">
                    <strong>ëŒ€ì¶œì„ ê³ ë ¤í•˜ì‹œë‚˜ìš”?</strong><br>
                    ëŒ€ì¶œ ì‹œ ì¶”ê°€ ë¹„ìš©: ê·¼ì €ë‹¹ê¶Œ ì„¤ì •ë¹„ìš© (ì•½ 20~30ë§Œì›), ì¸ì§€ì„¸, ëŒ€ì¶œ ì·¨ê¸‰ìˆ˜ìˆ˜ë£Œ ë“±ì´ ë³„ë„ë¡œ ë°œìƒí•©ë‹ˆë‹¤.
                    <br>
                    <a href="/calculator/ltv" style="color: var(--primary); font-weight: 600;">LTV ê³„ì‚°ê¸°</a>ì™€ 
                    <a href="/calculator/dsr" style="color: var(--primary); font-weight: 600;">DSR ê³„ì‚°ê¸°</a>ë¡œ ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡ì„ í™•ì¸í•˜ì„¸ìš”.
                </div>
            </div>

            <!-- ìƒì„¸ ê³„ì‚° ë§í¬ -->
            <div class="result-breakdown">
                <h3 class="breakdown-title">ìƒì„¸ ê³„ì‚° ë°”ë¡œê°€ê¸°</h3>
                <a href="/calculator/acquisition-tax" class="breakdown-item" style="cursor: pointer; text-decoration: none; transition: background 0.2s;">
                    <span class="breakdown-label">ğŸ“‹ ì·¨ë“ì„¸ ìì„¸íˆ ê³„ì‚°í•˜ê¸°</span>
                    <span class="breakdown-value" style="color: var(--primary);">â€º</span>
                </a>
                <a href="/calculator/brokerage-fee" class="breakdown-item" style="cursor: pointer; text-decoration: none; transition: background 0.2s;">
                    <span class="breakdown-label">ğŸ¤ ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ìì„¸íˆ ê³„ì‚°í•˜ê¸°</span>
                    <span class="breakdown-value" style="color: var(--primary);">â€º</span>
                </a>
                <a href="/calculator/registration-fee" class="breakdown-item" style="cursor: pointer; text-decoration: none; transition: background 0.2s;">
                    <span class="breakdown-label">ğŸ“ ë“±ê¸°ë¹„ìš© ìì„¸íˆ ê³„ì‚°í•˜ê¸°</span>
                    <span class="breakdown-value" style="color: var(--primary);">â€º</span>
                </a>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                </button>
                <button class="action-button primary" id="shareButton">
                    ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ê³„ì‚° ë²„íŠ¼ ì´ë²¤íŠ¸
            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculateTotalCost);
            }

            // ë¦¬ì…‹ ë²„íŠ¼ ì´ë²¤íŠ¸
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            // ê³µìœ  ë²„íŠ¼ ì´ë²¤íŠ¸
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // ìˆ«ì ì…ë ¥ í•„ë“œ í¬ë§·íŒ…
            const salePriceInput = document.getElementById('salePrice');
            if (salePriceInput) {
                salePriceInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    e.target.value = value;
                });

                // ì—”í„° í‚¤ë¡œ ê³„ì‚°
                salePriceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculateTotalCost();
                    }
                });
            }
        });

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        // ì› ë‹¨ìœ„ í‘œì‹œ
        function formatCurrency(num) {
            return formatNumber(num) + 'ì›';
        }

        // ì–µ/ë§Œ ë‹¨ìœ„ í‘œì‹œ
        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + 'ì–µ ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + 'ë§Œ ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + 'ì›';
        }

        // ì´ êµ¬ë§¤ë¹„ìš© ê³„ì‚° í•¨ìˆ˜
        function calculateTotalCost() {
            const salePrice = parseInt(document.getElementById('salePrice').value) || 0;
            
            if (salePrice === 0) {
                alert('ë§¤ë§¤ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const housingCount = parseInt(document.querySelector('input[name="housingCount"]:checked').value);
            const regulated = document.querySelector('input[name="regulated"]:checked').value;

            // 1. ì·¨ë“ì„¸ ê³„ì‚°
            let taxRate = 0;
            let educationRate = 0.1; // ì§€ë°©êµìœ¡ì„¸ 10%
            let ruralRate = 0; // ë†ì–´ì´ŒíŠ¹ë³„ì„¸

            if (housingCount === 0) {
                // ìƒì• ìµœì´ˆ (ë¬´ì£¼íƒ)
                if (salePrice <= 600000000) {
                    taxRate = 0.01; // 1%
                } else if (salePrice <= 900000000) {
                    taxRate = 0.02; // 2%
                } else {
                    taxRate = 0.03; // 3%
                }
            } else if (housingCount === 1) {
                // 1ì£¼íƒ
                if (salePrice <= 600000000) {
                    taxRate = 0.01; // 1%
                } else if (salePrice <= 900000000) {
                    taxRate = 0.02; // 2%
                } else {
                    taxRate = 0.03; // 3%
                }
            } else if (housingCount === 2) {
                // 2ì£¼íƒ
                if (regulated === 'yes') {
                    taxRate = 0.08; // 8%
                } else {
                    taxRate = 0.04; // 4%
                }
            } else {
                // 3ì£¼íƒ ì´ìƒ
                if (regulated === 'yes') {
                    taxRate = 0.12; // 12%
                } else {
                    taxRate = 0.04; // 4%
                }
            }

            // ë†ì–´ì´ŒíŠ¹ë³„ì„¸ (6ì–µ ì´ˆê³¼)
            if (salePrice > 600000000) {
                ruralRate = 0.002; // 0.2%
            }

            const baseTax = salePrice * taxRate;
            const educationTax = baseTax * educationRate;
            const ruralTax = salePrice * ruralRate;
            const acquisitionTax = baseTax + educationTax + ruralTax;

            // 2. ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ê³„ì‚° (ì„œìš¸ì‹œ ê¸°ì¤€ ë§¤ë§¤)
            let brokerageRate = 0;
            if (salePrice < 50000000) {
                brokerageRate = 0.006; // 0.6%
                const fee = salePrice * brokerageRate;
                var brokerageFee = fee > 250000 ? 250000 : fee;
            } else if (salePrice < 200000000) {
                brokerageRate = 0.005; // 0.5%
                const fee = salePrice * brokerageRate;
                var brokerageFee = fee > 800000 ? 800000 : fee;
            } else if (salePrice < 900000000) {
                brokerageRate = 0.004; // 0.4%
                var brokerageFee = salePrice * brokerageRate;
            } else if (salePrice < 1200000000) {
                brokerageRate = 0.005; // 0.5%
                var brokerageFee = salePrice * brokerageRate;
            } else if (salePrice < 1500000000) {
                brokerageRate = 0.006; // 0.6%
                var brokerageFee = salePrice * brokerageRate;
            } else {
                brokerageRate = 0.007; // 0.7%
                var brokerageFee = salePrice * brokerageRate;
            }

            // 3. ë“±ê¸°ë¹„ìš© ê³„ì‚°
            const registrationTax = salePrice * 0.02; // 2%
            const regEducationTax = registrationTax * 0.2; // 20%
            
            // êµ­ë¯¼ì£¼íƒì±„ê¶Œ
            let bondCost = 0;
            if (salePrice < 600000000) {
                bondCost = salePrice * 0.012; // 1.2%
            } else {
                bondCost = salePrice * 0.014; // 1.4%
            }

            // ë²•ë¬´ì‚¬ ìˆ˜ìˆ˜ë£Œ
            let lawyerFee = 0;
            if (salePrice < 100000000) {
                lawyerFee = 500000;
            } else if (salePrice < 300000000) {
                lawyerFee = 700000;
            } else if (salePrice < 600000000) {
                lawyerFee = 1000000;
            } else if (salePrice < 900000000) {
                lawyerFee = 1300000;
            } else {
                lawyerFee = 1500000;
            }

            const otherFee = 50000; // ê¸°íƒ€ ë¹„ìš©
            const registrationFee = registrationTax + regEducationTax + bondCost + lawyerFee + otherFee;

            // 4. ì´ ë¹„ìš© ê³„ì‚°
            const additionalCost = acquisitionTax + brokerageFee + registrationFee;
            const totalCost = salePrice + additionalCost;

            // 5. ë¹„ìœ¨ ê³„ì‚°
            const costRatio = (additionalCost / salePrice * 100).toFixed(1);
            const taxRatio = (acquisitionTax / additionalCost * 100).toFixed(1);

            // ì•ˆë‚´ ë©”ì‹œì§€
            let infoMessage = '';
            if (housingCount === 0) {
                infoMessage = 'ìƒì• ìµœì´ˆ ì£¼íƒ êµ¬ë§¤ë¡œ ì·¨ë“ì„¸ ê°ë©´ í˜œíƒì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.';
            } else if (housingCount >= 2 && regulated === 'yes') {
                infoMessage = 'ì¡°ì •ëŒ€ìƒì§€ì—­ ë‹¤ì£¼íƒ ì·¨ë“ìœ¼ë¡œ ì·¨ë“ì„¸ ì¤‘ê³¼ì„¸ìœ¨ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.';
            } else {
                infoMessage = `ë§¤ë§¤ê°€ ëŒ€ë¹„ ì•½ ${costRatio}%ì˜ ë¶€ëŒ€ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.`;
            }

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('totalCost').textContent = formatKoreanCurrency(totalCost);
            document.getElementById('displaySalePrice').textContent = formatCurrency(salePrice);
            document.getElementById('acquisitionTax').textContent = formatCurrency(acquisitionTax);
            document.getElementById('brokerageFee').textContent = formatCurrency(brokerageFee);
            document.getElementById('registrationFee').textContent = formatCurrency(registrationFee);
            document.getElementById('additionalCost').textContent = formatCurrency(additionalCost);
            document.getElementById('costRatio').textContent = costRatio + '%';
            document.getElementById('taxRatio').textContent = taxRatio + '%';
            document.getElementById('costInfo').textContent = infoMessage;

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ê³„ì‚°ê¸° ë¦¬ì…‹
        function resetCalculator() {
            document.getElementById('salePrice').value = '';
            document.querySelector('input[name="housingCount"][value="0"]').checked = true;
            document.querySelector('input[name="regulated"][value="yes"]').checked = true;
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ê²°ê³¼ ê³µìœ 
        function shareResult() {
            const salePrice = document.getElementById('displaySalePrice').textContent;
            const totalCost = document.getElementById('totalCost').textContent;
            const additionalCost = document.getElementById('additionalCost').textContent;
            const text = `ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°ì—ì„œ ì´ êµ¬ë§¤ë¹„ìš©ì„ ê³„ì‚°í–ˆì–´ìš”!\në§¤ë§¤ê°€: ${salePrice}\në¶€ëŒ€ë¹„ìš©: ${additionalCost}\nì´ í•„ìš” ê¸ˆì•¡: ${totalCost}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ì´ êµ¬ë§¤ë¹„ìš© ê³„ì‚° ê²°ê³¼',
                    text: text
                });
            } else {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
