<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡ (DSR) ê³„ì‚°ê¸° - ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ë¶€</div>
            <a href="/" style="text-decoration: none; color: inherit;">ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/buy" class="back-button">
            â† ì§‘ì„ ì‚¬ë ¤ê³  í•´ìš”
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">ğŸ’³</div>
            <h1 class="calculator-title">ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡ (DSR)</h1>
            <p class="calculator-subtitle">ì†Œë“ ëŒ€ë¹„ ëŒ€ì¶œ ê°€ëŠ¥í•œ ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </div>

        <!-- DSR ì•ˆë‚´ -->
        <div class="info-box">
            <div class="info-title">
                ğŸ’¡ DSR(ì´ë¶€ì±„ì›ë¦¬ê¸ˆìƒí™˜ë¹„ìœ¨)ì´ë€?
            </div>
            <div class="info-content">
                DSRì€ ì—°ê°„ ì†Œë“ ëŒ€ë¹„ ëª¨ë“  ëŒ€ì¶œì˜ ì›ë¦¬ê¸ˆ ìƒí™˜ì•¡ ë¹„ìœ¨ì…ë‹ˆë‹¤. 
                2024ë…„ ê¸°ì¤€ DSRì€ 40%ê°€ ì ìš©ë˜ë©°, ê³ ì†Œë“ì(ì—° 8ì²œë§Œì› ì´ˆê³¼)ëŠ” 50%ê°€ ì ìš©ë©ë‹ˆë‹¤.
            </div>
        </div>

        <!-- ê³„ì‚° ì…ë ¥ í¼ -->
        <div class="calc-section">
            <h2 class="calc-section-title">ì†Œë“ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ì—°ê°„ ì†Œë“ (ì„¸ì „)</label>
                <div class="input-wrapper">
                    <input type="text" id="annualIncome" class="input-field" placeholder="ì˜ˆ: 60000000" inputmode="numeric">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">ê·¼ë¡œì†Œë“, ì‚¬ì—…ì†Œë“ ë“± ëª¨ë“  ì†Œë“ í¬í•¨</div>
            </div>

            <div class="input-group">
                <label class="input-label">ê¸°ì¡´ ëŒ€ì¶œ ì—°ê°„ ì›ë¦¬ê¸ˆ ìƒí™˜ì•¡</label>
                <div class="input-wrapper">
                    <input type="text" id="existingLoan" class="input-field" placeholder="0" inputmode="numeric" value="0">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">ì‹ ìš©ëŒ€ì¶œ, ìë™ì°¨ í• ë¶€ ë“± ëª¨ë“  ëŒ€ì¶œ í¬í•¨</div>
            </div>
        </div>

        <div class="calc-section">
            <h2 class="calc-section-title">ëŒ€ì¶œ ì¡°ê±´</h2>
            
            <div class="input-group">
                <label class="input-label">ëŒ€ì¶œ ê¸ˆë¦¬</label>
                <div class="input-wrapper">
                    <input type="text" id="interestRate" class="input-field" placeholder="ì˜ˆ: 4.5" inputmode="decimal" value="4.5">
                    <span class="input-suffix">%</span>
                </div>
                <div class="input-helper">ì£¼íƒë‹´ë³´ëŒ€ì¶œ ê¸ˆë¦¬ (2026ë…„ í‰ê· : 4~5%)</div>
            </div>

            <div class="input-group">
                <label class="input-label">ëŒ€ì¶œ ê¸°ê°„</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="loanPeriod" value="20">
                        <span class="radio-label">20ë…„</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="loanPeriod" value="30" checked>
                        <span class="radio-label">30ë…„</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="loanPeriod" value="40">
                        <span class="radio-label">40ë…„</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ìƒí™˜ ë°©ì‹</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="repaymentType" value="equal" checked>
                        <span class="radio-label">ì›ë¦¬ê¸ˆê· ë“±ìƒí™˜</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="repaymentType" value="principal">
                        <span class="radio-label">ì›ê¸ˆê· ë“±ìƒí™˜</span>
                    </label>
                </div>
                <div class="input-helper">ì›ë¦¬ê¸ˆê· ë“±: ë§¤ì›” ê°™ì€ ê¸ˆì•¡ / ì›ê¸ˆê· ë“±: ì´ˆê¸° ë¶€ë‹´ ë†’ìŒ</div>
            </div>

            <button class="calc-button" id="calculateButton">
                ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡ ê³„ì‚°í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">ğŸ’° ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card total">
                <div class="result-label">ìµœëŒ€ ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡</div>
                <div class="result-value" id="maxLoanAmount">0ì›</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">DSR ìƒì„¸ ì •ë³´</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì—°ê°„ ì†Œë“</span>
                    <span class="breakdown-value" id="displayIncome">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì ìš© DSR ë¹„ìœ¨</span>
                    <span class="breakdown-value" id="dsrRate">40%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì—°ê°„ ìƒí™˜ ê°€ëŠ¥ì•¡</span>
                    <span class="breakdown-value" id="annualRepayment">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê¸°ì¡´ ëŒ€ì¶œ ìƒí™˜ì•¡</span>
                    <span class="breakdown-value" id="displayExisting">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì‹ ê·œ ëŒ€ì¶œ ê°€ëŠ¥ ìƒí™˜ì•¡</span>
                    <span class="breakdown-value" id="newLoanRepayment">0ì›</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ì›” ìƒí™˜ ì •ë³´</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì›” ìƒí™˜ì•¡</span>
                    <span class="breakdown-value" id="monthlyPayment">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì´ ìƒí™˜ì•¡</span>
                    <span class="breakdown-value" id="totalPayment">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì´ ì´ì</span>
                    <span class="breakdown-value" id="totalInterest">0ì›</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">â„¹ï¸</div>
                <div class="info-text" id="dsrInfo"></div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                </button>
                <button class="action-button primary" id="shareButton">
                    ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ê³„ì‚° ë²„íŠ¼ ì´ë²¤íŠ¸
            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculateDSR);
            }

            // ë¦¬ì…‹ ë²„íŠ¼ ì´ë²¤íŠ¸
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            // ê³µìœ  ë²„íŠ¼ ì´ë²¤íŠ¸
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // ìˆ«ì ì…ë ¥ í•„ë“œ í¬ë§·íŒ…
            const numericInputs = ['annualIncome', 'existingLoan'];
            numericInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/[^0-9]/g, '');
                        e.target.value = value;
                    });
                }
            });

            // ê¸ˆë¦¬ ì…ë ¥ í•„ë“œ
            const interestRateInput = document.getElementById('interestRate');
            if (interestRateInput) {
                interestRateInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9.]/g, '');
                    // ì†Œìˆ˜ì  í•˜ë‚˜ë§Œ í—ˆìš©
                    const parts = value.split('.');
                    if (parts.length > 2) {
                        value = parts[0] + '.' + parts.slice(1).join('');
                    }
                    e.target.value = value;
                });
            }

            // ì—”í„° í‚¤ë¡œ ê³„ì‚°
            ['annualIncome', 'existingLoan', 'interestRate'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            calculateDSR();
                        }
                    });
                }
            });
        });

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        // ì› ë‹¨ìœ„ í‘œì‹œ
        function formatCurrency(num) {
            return formatNumber(num) + 'ì›';
        }

        // ì–µ/ë§Œ ë‹¨ìœ„ í‘œì‹œ
        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + 'ì–µ ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + 'ë§Œ ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + 'ì›';
        }

        // ì›” ìƒí™˜ì•¡ ê³„ì‚° (ì›ë¦¬ê¸ˆê· ë“±)
        function calculateMonthlyPaymentEqual(principal, annualRate, months) {
            const monthlyRate = annualRate / 12 / 100;
            if (monthlyRate === 0) return principal / months;
            
            const payment = principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                           (Math.pow(1 + monthlyRate, months) - 1);
            return payment;
        }

        // ì›” ìƒí™˜ì•¡ ê³„ì‚° (ì›ê¸ˆê· ë“±)
        function calculateMonthlyPaymentPrincipal(principal, annualRate, months) {
            const monthlyRate = annualRate / 12 / 100;
            const principalPayment = principal / months;
            const firstInterest = principal * monthlyRate;
            return principalPayment + firstInterest;
        }

        // DSR ê³„ì‚° í•¨ìˆ˜
        function calculateDSR() {
            const annualIncome = parseInt(document.getElementById('annualIncome').value) || 0;
            const existingLoan = parseInt(document.getElementById('existingLoan').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 4.5;
            const loanPeriod = parseInt(document.querySelector('input[name="loanPeriod"]:checked').value);
            const repaymentType = document.querySelector('input[name="repaymentType"]:checked').value;
            
            if (annualIncome === 0) {
                alert('ì—°ê°„ ì†Œë“ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // DSR ë¹„ìœ¨ ê²°ì • (ì—° 8ì²œë§Œì› ì´ˆê³¼: 50%, ì´í•˜: 40%)
            const dsrRate = annualIncome > 80000000 ? 0.5 : 0.4;
            
            // ì—°ê°„ ìƒí™˜ ê°€ëŠ¥ì•¡
            const annualRepaymentCapacity = annualIncome * dsrRate;
            
            // ì‹ ê·œ ëŒ€ì¶œ ê°€ëŠ¥ ì—°ê°„ ìƒí™˜ì•¡
            const newLoanAnnualRepayment = annualRepaymentCapacity - existingLoan;
            
            if (newLoanAnnualRepayment <= 0) {
                alert('ê¸°ì¡´ ëŒ€ì¶œ ìƒí™˜ì•¡ì´ DSR í•œë„ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ì¶”ê°€ ëŒ€ì¶œì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            // ì›” ìƒí™˜ì•¡
            const monthlyRepayment = newLoanAnnualRepayment / 12;
            
            // ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡ ì—­ì‚°
            const months = loanPeriod * 12;
            const monthlyRate = interestRate / 12 / 100;
            
            let maxLoan;
            if (repaymentType === 'equal') {
                // ì›ë¦¬ê¸ˆê· ë“±: P = M * [(1 - (1 + r)^-n) / r]
                if (monthlyRate === 0) {
                    maxLoan = monthlyRepayment * months;
                } else {
                    maxLoan = monthlyRepayment * ((1 - Math.pow(1 + monthlyRate, -months)) / monthlyRate);
                }
            } else {
                // ì›ê¸ˆê· ë“±: ì²« ë‹¬ ìƒí™˜ì•¡ = ì›ê¸ˆ/n + ì›ê¸ˆ*r
                // M = P/n + P*r
                // M = P(1/n + r)
                // P = M / (1/n + r)
                maxLoan = monthlyRepayment / (1/months + monthlyRate);
            }

            // ì´ ìƒí™˜ì•¡ ê³„ì‚°
            let totalPayment;
            let monthlyPayment;
            
            if (repaymentType === 'equal') {
                monthlyPayment = calculateMonthlyPaymentEqual(maxLoan, interestRate, months);
                totalPayment = monthlyPayment * months;
            } else {
                monthlyPayment = calculateMonthlyPaymentPrincipal(maxLoan, interestRate, months);
                // ì›ê¸ˆê· ë“±ì€ ë§¤ì›” ê°ì†Œí•˜ë¯€ë¡œ í‰ê· ê°’ ì‚¬ìš©
                const lastMonthPayment = maxLoan / months + (maxLoan / months) * monthlyRate;
                totalPayment = (monthlyPayment + lastMonthPayment) / 2 * months;
            }

            const totalInterest = totalPayment - maxLoan;

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('maxLoanAmount').textContent = formatKoreanCurrency(maxLoan);
            document.getElementById('displayIncome').textContent = formatCurrency(annualIncome);
            document.getElementById('dsrRate').textContent = (dsrRate * 100) + '%';
            document.getElementById('annualRepayment').textContent = formatCurrency(annualRepaymentCapacity);
            document.getElementById('displayExisting').textContent = formatCurrency(existingLoan);
            document.getElementById('newLoanRepayment').textContent = formatCurrency(newLoanAnnualRepayment);
            document.getElementById('monthlyPayment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('totalPayment').textContent = formatCurrency(totalPayment);
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);

            // ì•ˆë‚´ ë©”ì‹œì§€
            let infoMessage = '';
            if (annualIncome > 80000000) {
                infoMessage = 'ì—° ì†Œë“ 8ì²œë§Œì› ì´ˆê³¼ë¡œ DSR 50%ê°€ ì ìš©ë©ë‹ˆë‹¤. ';
            } else {
                infoMessage = 'DSR 40%ê°€ ì ìš©ë©ë‹ˆë‹¤. ';
            }
            infoMessage += `${loanPeriod}ë…„ ${repaymentType === 'equal' ? 'ì›ë¦¬ê¸ˆê· ë“±' : 'ì›ê¸ˆê· ë“±'}ìƒí™˜ ê¸°ì¤€ì…ë‹ˆë‹¤.`;
            
            document.getElementById('dsrInfo').textContent = infoMessage;

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ê³„ì‚°ê¸° ë¦¬ì…‹
        function resetCalculator() {
            document.getElementById('annualIncome').value = '';
            document.getElementById('existingLoan').value = '0';
            document.getElementById('interestRate').value = '4.5';
            document.querySelector('input[name="loanPeriod"][value="30"]').checked = true;
            document.querySelector('input[name="repaymentType"][value="equal"]').checked = true;
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ê²°ê³¼ ê³µìœ 
        function shareResult() {
            const maxLoan = document.getElementById('maxLoanAmount').textContent;
            const monthlyPayment = document.getElementById('monthlyPayment').textContent;
            const text = `ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°ì—ì„œ DSR ê³„ì‚°í–ˆì–´ìš”!\nìµœëŒ€ ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡: ${maxLoan}\nì›” ìƒí™˜ì•¡: ${monthlyPayment}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'DSR ê³„ì‚° ê²°ê³¼',
                    text: text
                });
            } else {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
