<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ê³„ì‚°ê¸° - ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ë¶€</div>
            <a href="/" style="text-decoration: none; color: inherit;">ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/sell" class="back-button">
            â† ì§‘ì„ íŒ”ë ¤ê³  í•´ìš”
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">ğŸ“…</div>
            <h1 class="calculator-title">ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ê³„ì‚°ê¸°</h1>
            <p class="calculator-subtitle">ë³´ìœ Â·ê±°ì£¼ ê¸°ê°„ì— ë”°ë¥¸ ê³µì œìœ¨ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ì•ˆë‚´ -->
        <div class="info-box">
            <div class="info-title">
                ğŸ’¡ ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œë€?
            </div>
            <div class="info-content">
                ì£¼íƒì„ ì˜¤ë˜ ë³´ìœ Â·ê±°ì£¼í• ìˆ˜ë¡ ì–‘ë„ì°¨ìµì—ì„œ ë” ë§ì´ ê³µì œí•´ì£¼ëŠ” ì œë„ì…ë‹ˆë‹¤.
                <br><br>
                â€¢ <strong>1ì£¼íƒì</strong>: ë³´ìœ ê¸°ê°„ + ê±°ì£¼ê¸°ê°„ í˜¼í•© (ìµœëŒ€ 80%)<br>
                &nbsp;&nbsp;- ë³´ìœ : ì—° 4%ì”© ìµœëŒ€ 40% (10ë…„)<br>
                &nbsp;&nbsp;- ê±°ì£¼: ì—° 4%ì”© ìµœëŒ€ 40% (10ë…„)<br>
                â€¢ <strong>ë‹¤ì£¼íƒì</strong>: ë³´ìœ ê¸°ê°„ë§Œ (ìµœëŒ€ 30%)<br>
                &nbsp;&nbsp;- ë³´ìœ : ì—° 2%ì”© ìµœëŒ€ 30% (15ë…„)
            </div>
        </div>

        <!-- ê³„ì‚° ì…ë ¥ í¼ -->
        <div class="calc-section">
            <h2 class="calc-section-title">ê¸°ê°„ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ì·¨ë“ì¼</label>
                <div class="input-wrapper">
                    <input type="date" id="acquisitionDate" class="input-field">
                </div>
                <div class="input-helper">ì£¼íƒì„ ì·¨ë“í•œ ë‚ ì§œ</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì–‘ë„ ì˜ˆì •ì¼</label>
                <div class="input-wrapper">
                    <input type="date" id="transferDate" class="input-field">
                </div>
                <div class="input-helper">ì£¼íƒì„ ì–‘ë„í•  ì˜ˆì • ë‚ ì§œ</div>
            </div>

            <div class="input-group" id="residenceSection">
                <label class="input-label">ì‹¤ê±°ì£¼ ì‹œì‘ì¼</label>
                <div class="input-wrapper">
                    <input type="date" id="residenceStartDate" class="input-field">
                </div>
                <div class="input-helper">ì‹¤ì œ ê±°ì£¼ë¥¼ ì‹œì‘í•œ ë‚ ì§œ (1ì£¼íƒë§Œ í•´ë‹¹)</div>
            </div>

            <div class="input-group" id="residenceEndSection">
                <label class="input-label">ì‹¤ê±°ì£¼ ì¢…ë£Œì¼ (ì„ íƒ)</label>
                <div class="input-wrapper">
                    <input type="date" id="residenceEndDate" class="input-field">
                </div>
                <div class="input-helper">ë¹„ì›Œë‘ë©´ ì–‘ë„ì¼ê¹Œì§€ ê±°ì£¼í•œ ê²ƒìœ¼ë¡œ ê³„ì‚°</div>
            </div>
        </div>

        <div class="calc-section">
            <h2 class="calc-section-title">ì£¼íƒ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ë³´ìœ  ì£¼íƒ ìˆ˜</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="1" checked>
                        <span class="radio-label">1ì£¼íƒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="2">
                        <span class="radio-label">2ì£¼íƒ ì´ìƒ</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ì–‘ë„ì°¨ìµ (ì„ íƒ)</label>
                <div class="input-wrapper">
                    <input type="text" id="capitalGain" class="input-field" placeholder="0" inputmode="numeric">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">ì–‘ë„ì°¨ìµì„ ì…ë ¥í•˜ë©´ ì‹¤ì œ ê³µì œ ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤</div>
            </div>

            <button class="calc-button" id="calculateButton">
                ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ê³„ì‚°í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">ğŸ“… ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card total">
                <div class="result-label">ì´ ê³µì œìœ¨</div>
                <div class="result-value" id="totalDeductionRate">0%</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ë³´ìœ ê¸°ê°„ ê³µì œ</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë³´ìœ ê¸°ê°„</span>
                    <span class="breakdown-value" id="holdingPeriod">0ë…„ 0ê°œì›”</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë³´ìœ ê¸°ê°„ ê³µì œìœ¨</span>
                    <span class="breakdown-value" id="holdingDeductionRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê³„ì‚° ë°©ì‹</span>
                    <span class="breakdown-value" id="holdingFormula">-</span>
                </div>
            </div>

            <div class="result-breakdown" id="residenceSection">
                <h3 class="breakdown-title">ê±°ì£¼ê¸°ê°„ ê³µì œ (1ì£¼íƒë§Œ í•´ë‹¹)</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê±°ì£¼ê¸°ê°„</span>
                    <span class="breakdown-value" id="residencePeriod">0ë…„ 0ê°œì›”</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê±°ì£¼ê¸°ê°„ ê³µì œìœ¨</span>
                    <span class="breakdown-value" id="residenceDeductionRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê³„ì‚° ë°©ì‹</span>
                    <span class="breakdown-value" id="residenceFormula">-</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ê³µì œ ìš”ì•½</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë³´ìœ ê¸°ê°„ ê³µì œ</span>
                    <span class="breakdown-value" id="displayHoldingRate">0%</span>
                </div>
                <div class="breakdown-item" id="displayResidenceItem">
                    <span class="breakdown-label">ê±°ì£¼ê¸°ê°„ ê³µì œ</span>
                    <span class="breakdown-value" id="displayResidenceRate">0%</span>
                </div>
                <div class="breakdown-item" style="background: rgba(0, 217, 181, 0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700; color: var(--secondary);">ì´ ê³µì œìœ¨</span>
                    <span class="breakdown-value" style="font-weight: 700; color: var(--secondary);" id="displayTotalRate">0%</span>
                </div>
            </div>

            <div class="result-breakdown" id="amountSection" style="display: none;">
                <h3 class="breakdown-title">ê³µì œ ê¸ˆì•¡</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì–‘ë„ì°¨ìµ</span>
                    <span class="breakdown-value" id="displayCapitalGain">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê³µì œìœ¨</span>
                    <span class="breakdown-value" id="deductionRateForAmount">0%</span>
                </div>
                <div class="breakdown-item" style="background: rgba(0, 102, 255, 0.05); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700; color: var(--primary);">ê³µì œ ê¸ˆì•¡</span>
                    <span class="breakdown-value" style="font-weight: 700; color: var(--primary);" id="deductionAmount">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê³µì œ í›„ ê³¼ì„¸ ëŒ€ìƒ</span>
                    <span class="breakdown-value" id="taxableAmount">0ì›</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ê¸°ê°„ë³„ ê³µì œìœ¨ ë³€í™”</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">í˜„ì¬ (ë³´ìœ  <span id="currentYears">0</span>ë…„)</span>
                    <span class="breakdown-value" id="currentRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">+1ë…„ í›„</span>
                    <span class="breakdown-value" id="nextYearRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">+2ë…„ í›„</span>
                    <span class="breakdown-value" id="twoYearsRate">0%</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ìµœëŒ€ ê³µì œìœ¨ ë‹¬ì„±ê¹Œì§€</span>
                    <span class="breakdown-value" id="maxDeductionYear">-</span>
                </div>
            </div>

            <div class="result-info">
                <div class="info-icon">â„¹ï¸</div>
                <div class="info-text" id="resultInfo"></div>
            </div>

            <div class="result-info" style="background: rgba(0, 217, 181, 0.05); border-color: rgba(0, 217, 181, 0.2);">
                <div class="info-icon">ğŸ’¡</div>
                <div class="info-text">
                    <strong>ê³µì œìœ¨ ê·¹ëŒ€í™” ì „ëµ</strong><br>
                    â€¢ 1ì£¼íƒ: ë³´ìœ Â·ê±°ì£¼ ëª¨ë‘ 10ë…„ ì´ìƒ â†’ 80% ê³µì œ<br>
                    â€¢ ë‹¤ì£¼íƒ: ë³´ìœ  15ë…„ ì´ìƒ â†’ 30% ê³µì œ<br>
                    â€¢ 1ë…„ ë” ë³´ìœ  ì‹œ ê³µì œìœ¨ ì¦ê°€ íš¨ê³¼ í™•ì¸<br>
                    â€¢ ê±°ì£¼ê¸°ê°„ ì¦ëª… ìë£Œ ë°˜ë“œì‹œ ë³´ê´€ (ì£¼ë¯¼ë“±ë¡ë“±ë³¸, ê³µê³¼ê¸ˆ)
                </div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                </button>
                <button class="action-button primary" id="shareButton">
                    ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transferDate').value = today;

            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', calculateDeduction);
            }

            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // ìˆ«ì ì…ë ¥
            const capitalGainInput = document.getElementById('capitalGain');
            if (capitalGainInput) {
                capitalGainInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    e.target.value = value;
                });
            }

            // ì£¼íƒ ìˆ˜ì— ë”°ë¼ ê±°ì£¼ ì„¹ì…˜ í‘œì‹œ
            const housingCountInputs = document.querySelectorAll('input[name="housingCount"]');
            housingCountInputs.forEach(input => {
                input.addEventListener('change', function() {
                    const residenceSection = document.getElementById('residenceSection');
                    const residenceEndSection = document.getElementById('residenceEndSection');
                    if (this.value === '1') {
                        residenceSection.style.display = 'block';
                        residenceEndSection.style.display = 'block';
                    } else {
                        residenceSection.style.display = 'none';
                        residenceEndSection.style.display = 'none';
                    }
                });
            });
        });

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        function formatCurrency(num) {
            return formatNumber(num) + 'ì›';
        }

        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + 'ì–µ ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + 'ë§Œ ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + 'ì›';
        }

        function calculatePeriod(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            const diffTime = end - start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            const days = diffDays % 30;
            
            return {
                years: years,
                months: months,
                days: days,
                totalDays: diffDays,
                totalYears: diffDays / 365
            };
        }

        function calculateDeduction() {
            const acquisitionDate = document.getElementById('acquisitionDate').value;
            const transferDate = document.getElementById('transferDate').value;
            const housingCount = parseInt(document.querySelector('input[name="housingCount"]:checked').value);
            const capitalGain = parseInt(document.getElementById('capitalGain').value) || 0;
            
            if (!acquisitionDate || !transferDate) {
                alert('ì·¨ë“ì¼ê³¼ ì–‘ë„ ì˜ˆì •ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë³´ìœ ê¸°ê°„ ê³„ì‚°
            const holdingPeriod = calculatePeriod(acquisitionDate, transferDate);

            // ê±°ì£¼ê¸°ê°„ ê³„ì‚° (1ì£¼íƒë§Œ)
            let residencePeriod = { years: 0, months: 0, days: 0, totalYears: 0 };
            if (housingCount === 1) {
                const residenceStartDate = document.getElementById('residenceStartDate').value;
                let residenceEndDate = document.getElementById('residenceEndDate').value;
                
                if (residenceStartDate) {
                    if (!residenceEndDate) {
                        residenceEndDate = transferDate;
                    }
                    residencePeriod = calculatePeriod(residenceStartDate, residenceEndDate);
                }
            }

            // ê³µì œìœ¨ ê³„ì‚°
            let holdingDeductionRate = 0;
            let residenceDeductionRate = 0;

            if (housingCount === 1) {
                // 1ì£¼íƒ: ë³´ìœ  ì—° 4%, ê±°ì£¼ ì—° 4%
                holdingDeductionRate = Math.min(holdingPeriod.totalYears * 4, 40);
                residenceDeductionRate = Math.min(residencePeriod.totalYears * 4, 40);
            } else {
                // ë‹¤ì£¼íƒ: ë³´ìœ  ì—° 2%
                holdingDeductionRate = Math.min(holdingPeriod.totalYears * 2, 30);
                residenceDeductionRate = 0;
            }

            const totalDeductionRate = Math.min(holdingDeductionRate + residenceDeductionRate, 
                                                 housingCount === 1 ? 80 : 30);

            // ê³µì œ ê¸ˆì•¡ ê³„ì‚°
            let deductionAmount = 0;
            let taxableAmount = 0;
            if (capitalGain > 0) {
                deductionAmount = capitalGain * (totalDeductionRate / 100);
                taxableAmount = capitalGain - deductionAmount;
            }

            // ë¯¸ë˜ ê³µì œìœ¨ ê³„ì‚°
            const futureHolding1 = Math.min((holdingPeriod.totalYears + 1) * (housingCount === 1 ? 4 : 2), 
                                            housingCount === 1 ? 40 : 30);
            const futureResidence1 = housingCount === 1 ? 
                                     Math.min((residencePeriod.totalYears + 1) * 4, 40) : 0;
            const nextYearRate = Math.min(futureHolding1 + futureResidence1, housingCount === 1 ? 80 : 30);

            const futureHolding2 = Math.min((holdingPeriod.totalYears + 2) * (housingCount === 1 ? 4 : 2), 
                                            housingCount === 1 ? 40 : 30);
            const futureResidence2 = housingCount === 1 ? 
                                     Math.min((residencePeriod.totalYears + 2) * 4, 40) : 0;
            const twoYearsRate = Math.min(futureHolding2 + futureResidence2, housingCount === 1 ? 80 : 30);

            // ìµœëŒ€ ê³µì œìœ¨ ë‹¬ì„±ê¹Œì§€
            const maxRate = housingCount === 1 ? 80 : 30;
            let maxDeductionYear = '-';
            if (totalDeductionRate < maxRate) {
                if (housingCount === 1) {
                    const yearsToMax = Math.ceil((maxRate - totalDeductionRate) / 8); // ë³´ìœ +ê±°ì£¼ í•©ì‚° ì—° 8%
                    maxDeductionYear = `ì•½ ${yearsToMax}ë…„ í›„ (${maxRate}% ë‹¬ì„±)`;
                } else {
                    const yearsToMax = Math.ceil((maxRate - totalDeductionRate) / 2);
                    maxDeductionYear = `ì•½ ${yearsToMax}ë…„ í›„ (${maxRate}% ë‹¬ì„±)`;
                }
            } else {
                maxDeductionYear = 'ì´ë¯¸ ìµœëŒ€ ê³µì œìœ¨ ë‹¬ì„±';
            }

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('totalDeductionRate').textContent = totalDeductionRate.toFixed(0) + '%';
            
            document.getElementById('holdingPeriod').textContent = 
                `${holdingPeriod.years}ë…„ ${holdingPeriod.months}ê°œì›” ${holdingPeriod.days}ì¼`;
            document.getElementById('holdingDeductionRate').textContent = holdingDeductionRate.toFixed(1) + '%';
            
            if (housingCount === 1) {
                document.getElementById('holdingFormula').textContent = 
                    `${holdingPeriod.years}ë…„ Ã— 4% = ${holdingDeductionRate.toFixed(1)}% (ìµœëŒ€ 40%)`;
                
                document.getElementById('residencePeriod').textContent = 
                    `${residencePeriod.years}ë…„ ${residencePeriod.months}ê°œì›” ${residencePeriod.days}ì¼`;
                document.getElementById('residenceDeductionRate').textContent = residenceDeductionRate.toFixed(1) + '%';
                document.getElementById('residenceFormula').textContent = 
                    `${residencePeriod.years}ë…„ Ã— 4% = ${residenceDeductionRate.toFixed(1)}% (ìµœëŒ€ 40%)`;
                
                document.getElementById('displayResidenceItem').style.display = 'flex';
                document.getElementById('displayResidenceRate').textContent = residenceDeductionRate.toFixed(1) + '%';
            } else {
                document.getElementById('holdingFormula').textContent = 
                    `${holdingPeriod.years}ë…„ Ã— 2% = ${holdingDeductionRate.toFixed(1)}% (ìµœëŒ€ 30%)`;
                
                document.getElementById('displayResidenceItem').style.display = 'none';
            }
            
            document.getElementById('displayHoldingRate').textContent = holdingDeductionRate.toFixed(1) + '%';
            document.getElementById('displayTotalRate').textContent = totalDeductionRate.toFixed(0) + '%';

            // ê³µì œ ê¸ˆì•¡
            if (capitalGain > 0) {
                document.getElementById('amountSection').style.display = 'block';
                document.getElementById('displayCapitalGain').textContent = formatCurrency(capitalGain);
                document.getElementById('deductionRateForAmount').textContent = totalDeductionRate.toFixed(0) + '%';
                document.getElementById('deductionAmount').textContent = formatCurrency(deductionAmount);
                document.getElementById('taxableAmount').textContent = formatCurrency(taxableAmount);
            } else {
                document.getElementById('amountSection').style.display = 'none';
            }

            // ë¯¸ë˜ ê³µì œìœ¨
            document.getElementById('currentYears').textContent = holdingPeriod.years;
            document.getElementById('currentRate').textContent = totalDeductionRate.toFixed(0) + '%';
            document.getElementById('nextYearRate').textContent = 
                nextYearRate.toFixed(0) + '% (â–²' + (nextYearRate - totalDeductionRate).toFixed(1) + '%p)';
            document.getElementById('twoYearsRate').textContent = 
                twoYearsRate.toFixed(0) + '% (â–²' + (twoYearsRate - totalDeductionRate).toFixed(1) + '%p)';
            document.getElementById('maxDeductionYear').textContent = maxDeductionYear;

            // ì•ˆë‚´ ë©”ì‹œì§€
            let resultInfo = '';
            if (housingCount === 1) {
                resultInfo = `1ì£¼íƒìœ¼ë¡œ ë³´ìœ  ${holdingDeductionRate.toFixed(1)}% + ê±°ì£¼ ${residenceDeductionRate.toFixed(1)}% = ì´ ${totalDeductionRate.toFixed(0)}% ê³µì œìœ¨ì´ ì ìš©ë©ë‹ˆë‹¤.`;
                if (totalDeductionRate < 80) {
                    resultInfo += ` ë³´ìœ Â·ê±°ì£¼ë¥¼ ê³„ì†í•˜ë©´ ê³µì œìœ¨ì´ ë” ì¦ê°€í•©ë‹ˆë‹¤.`;
                } else {
                    resultInfo += ` ì´ë¯¸ ìµœëŒ€ ê³µì œìœ¨ 80%ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!`;
                }
            } else {
                resultInfo = `ë‹¤ì£¼íƒìœ¼ë¡œ ë³´ìœ  ${holdingDeductionRate.toFixed(1)}% ê³µì œìœ¨ì´ ì ìš©ë©ë‹ˆë‹¤ (ê±°ì£¼ê¸°ê°„ ê³µì œ ì—†ìŒ).`;
                if (totalDeductionRate < 30) {
                    resultInfo += ` 15ë…„ ë³´ìœ  ì‹œ ìµœëŒ€ 30%ê¹Œì§€ ê³µì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
                } else {
                    resultInfo += ` ì´ë¯¸ ìµœëŒ€ ê³µì œìœ¨ 30%ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.`;
                }
            }

            document.getElementById('resultInfo').textContent = resultInfo;

            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetCalculator() {
            document.getElementById('acquisitionDate').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transferDate').value = today;
            document.getElementById('residenceStartDate').value = '';
            document.getElementById('residenceEndDate').value = '';
            document.getElementById('capitalGain').value = '';
            document.querySelector('input[name="housingCount"][value="1"]').checked = true;
            document.getElementById('residenceSection').style.display = 'block';
            document.getElementById('residenceEndSection').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareResult() {
            const totalRate = document.getElementById('totalDeductionRate').textContent;
            const holdingPeriod = document.getElementById('holdingPeriod').textContent;
            const text = `ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°ì—ì„œ ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œë¥¼ ê³„ì‚°í–ˆì–´ìš”!\nì´ ê³µì œìœ¨: ${totalRate}\në³´ìœ ê¸°ê°„: ${holdingPeriod}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ê³„ì‚° ê²°ê³¼',
                    text: text
                });
            } else {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
