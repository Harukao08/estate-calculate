<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ í™•ì¸ - ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ë¶€</div>
            <a href="/" style="text-decoration: none; color: inherit;">ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 80px;">
        <a href="/sell" class="back-button">
            â† ì§‘ì„ íŒ”ë ¤ê³  í•´ìš”
        </a>

        <div class="calculator-header">
            <div class="calculator-icon-large">ğŸ¡</div>
            <h1 class="calculator-title">1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ í™•ì¸</h1>
            <p class="calculator-subtitle">ì–‘ë„ì†Œë“ì„¸ ë¹„ê³¼ì„¸ ìš”ê±´ ì¶©ì¡± ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ë¹„ê³¼ì„¸ ì•ˆë‚´ -->
        <div class="info-box">
            <div class="info-title">
                ğŸ’¡ 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ë€?
            </div>
            <div class="info-content">
                ì¼ì • ìš”ê±´ì„ ì¶©ì¡±í•œ 1ì„¸ëŒ€ 1ì£¼íƒìê°€ ì£¼íƒì„ ì–‘ë„í•  ë•Œ ì–‘ë„ì†Œë“ì„¸ê°€ ë©´ì œë˜ëŠ” ì œë„ì…ë‹ˆë‹¤.
                <br><br>
                <strong>ê¸°ë³¸ ìš”ê±´</strong><br>
                â€¢ ë³´ìœ ê¸°ê°„ 2ë…„ ì´ìƒ<br>
                â€¢ ê±°ì£¼ê¸°ê°„ 2ë…„ ì´ìƒ (2021ë…„ ì´í›„ ì·¨ë“ë¶„)<br>
                â€¢ ì–‘ë„ ì‹œì ì— 1ì£¼íƒë§Œ ë³´ìœ <br>
                â€¢ ë¹„ê³¼ì„¸ í•œë„: 12ì–µì› (2023ë…„ë¶€í„°)
            </div>
        </div>

        <!-- ê³„ì‚° ì…ë ¥ í¼ -->
        <div class="calc-section">
            <h2 class="calc-section-title">ì£¼íƒ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ì·¨ë“ì¼</label>
                <div class="input-wrapper">
                    <input type="date" id="acquisitionDate" class="input-field">
                </div>
                <div class="input-helper">ì£¼íƒì„ ì·¨ë“í•œ ë‚ ì§œ</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì–‘ë„ ì˜ˆì •ì¼</label>
                <div class="input-wrapper">
                    <input type="date" id="transferDate" class="input-field">
                </div>
                <div class="input-helper">ì£¼íƒì„ ì–‘ë„í•  ì˜ˆì • ë‚ ì§œ</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì‹¤ê±°ì£¼ ì‹œì‘ì¼</label>
                <div class="input-wrapper">
                    <input type="date" id="residenceStartDate" class="input-field">
                </div>
                <div class="input-helper">ì‹¤ì œ ê±°ì£¼ë¥¼ ì‹œì‘í•œ ë‚ ì§œ</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì‹¤ê±°ì£¼ ì¢…ë£Œì¼ (ë¹„ì›Œë‘ë©´ ì–‘ë„ì¼ê¹Œì§€)</label>
                <div class="input-wrapper">
                    <input type="date" id="residenceEndDate" class="input-field">
                </div>
                <div class="input-helper">ì„ íƒì‚¬í•­: ê±°ì£¼ë¥¼ ì¢…ë£Œí•œ ë‚ ì§œ</div>
            </div>
        </div>

        <div class="calc-section">
            <h2 class="calc-section-title">ì£¼íƒ í˜„í™©</h2>
            
            <div class="input-group">
                <label class="input-label">ì–‘ë„ ì‹œì  ë³´ìœ  ì£¼íƒ ìˆ˜</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="1" checked>
                        <span class="radio-label">1ì£¼íƒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="housingCount" value="2">
                        <span class="radio-label">2ì£¼íƒ ì´ìƒ</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ì£¼íƒ ì†Œì¬ì§€</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="location" value="general" checked>
                        <span class="radio-label">ì¼ë°˜ì§€ì—­</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="location" value="regulated">
                        <span class="radio-label">ì¡°ì •ëŒ€ìƒì§€ì—­</span>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ì–‘ë„ê°€ì•¡ (ì˜ˆìƒ)</label>
                <div class="input-wrapper">
                    <input type="text" id="transferPrice" class="input-field" placeholder="ì˜ˆ: 1000000000" inputmode="numeric">
                    <span class="input-suffix">ì›</span>
                </div>
                <div class="input-helper">ì£¼íƒì„ íŒë§¤í•  ì˜ˆìƒ ê¸ˆì•¡</div>
            </div>
        </div>

        <div class="calc-section">
            <h2 class="calc-section-title">ì„¸ëŒ€ ì •ë³´</h2>
            
            <div class="input-group">
                <label class="input-label">ì„¸ëŒ€ êµ¬ì„±</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="household" value="single" checked>
                        <span class="radio-label">1ì„¸ëŒ€ (ë…ë¦½ ì„¸ëŒ€)</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="household" value="multiple">
                        <span class="radio-label">ë‹¤ì„¸ëŒ€ (ë¶€ëª¨ ë“±ê³¼ ë™ê±°)</span>
                    </label>
                </div>
                <div class="input-helper">ë°°ìš°ì ë° ë¯¸í˜¼ ìë…€ì™€ í•¨ê»˜ ì‚¬ëŠ” ë…ë¦½ ì„¸ëŒ€</div>
            </div>

            <div class="input-group">
                <label class="input-label">ì„¸ëŒ€ì› ì¤‘ ë‹¤ë¥¸ ì£¼íƒ ë³´ìœ ì</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="otherHousing" value="no" checked>
                        <span class="radio-label">ì—†ìŒ</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="otherHousing" value="yes">
                        <span class="radio-label">ìˆìŒ</span>
                    </label>
                </div>
                <div class="input-helper">ë°°ìš°ìë‚˜ ë¯¸í˜¼ ìë…€ê°€ ë‹¤ë¥¸ ì£¼íƒì„ ë³´ìœ í•˜ê³  ìˆëŠ”ì§€</div>
            </div>

            <button class="calc-button" id="calculateButton">
                ë¹„ê³¼ì„¸ ìš”ê±´ í™•ì¸í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="resultSection" class="result-section" style="display: none;">
            <h2 class="result-title">ğŸ¡ í™•ì¸ ê²°ê³¼</h2>
            
            <div class="result-card total" id="resultCard">
                <div class="result-label">ë¹„ê³¼ì„¸ ì ìš© ì—¬ë¶€</div>
                <div class="result-value" id="exemptionStatus">-</div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ìš”ê±´ ì¶©ì¡± í˜„í™©</h3>
                <div class="breakdown-item" id="householdStatus">
                    <span class="breakdown-label">1ì„¸ëŒ€ ìš”ê±´</span>
                    <span class="breakdown-value" id="householdResult">-</span>
                </div>
                <div class="breakdown-item" id="housingStatus">
                    <span class="breakdown-label">1ì£¼íƒ ìš”ê±´</span>
                    <span class="breakdown-value" id="housingResult">-</span>
                </div>
                <div class="breakdown-item" id="holdingStatus">
                    <span class="breakdown-label">ë³´ìœ ê¸°ê°„ ìš”ê±´ (2ë…„ ì´ìƒ)</span>
                    <span class="breakdown-value" id="holdingResult">-</span>
                </div>
                <div class="breakdown-item" id="residenceStatus">
                    <span class="breakdown-label">ê±°ì£¼ê¸°ê°„ ìš”ê±´ (2ë…„ ì´ìƒ)</span>
                    <span class="breakdown-value" id="residenceResult">-</span>
                </div>
                <div class="breakdown-item" id="priceStatus">
                    <span class="breakdown-label">ë¹„ê³¼ì„¸ í•œë„ (12ì–µì›)</span>
                    <span class="breakdown-value" id="priceResult">-</span>
                </div>
            </div>

            <div class="result-breakdown">
                <h3 class="breakdown-title">ê¸°ê°„ ìƒì„¸</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë³´ìœ ê¸°ê°„</span>
                    <span class="breakdown-value" id="holdingPeriod">0ë…„ 0ê°œì›”</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ê±°ì£¼ê¸°ê°„</span>
                    <span class="breakdown-value" id="residencePeriod">0ë…„ 0ê°œì›”</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì·¨ë“ì¼</span>
                    <span class="breakdown-value" id="displayAcquisitionDate">-</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì–‘ë„ ì˜ˆì •ì¼</span>
                    <span class="breakdown-value" id="displayTransferDate">-</span>
                </div>
            </div>

            <div class="result-breakdown" id="taxSection" style="display: none;">
                <h3 class="breakdown-title">ë¹„ê³¼ì„¸ ê¸ˆì•¡</h3>
                <div class="breakdown-item">
                    <span class="breakdown-label">ì–‘ë„ê°€ì•¡</span>
                    <span class="breakdown-value" id="displayTransferPrice">0ì›</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">ë¹„ê³¼ì„¸ í•œë„</span>
                    <span class="breakdown-value" id="exemptionLimit">12ì–µì›</span>
                </div>
                <div class="breakdown-item" style="background: rgba(0, 217, 181, 0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    <span class="breakdown-label" style="font-weight: 700; color: var(--secondary);">ë¹„ê³¼ì„¸ ê¸ˆì•¡</span>
                    <span class="breakdown-value" style="font-weight: 700; color: var(--secondary);" id="exemptionAmount">0ì›</span>
                </div>
                <div class="breakdown-item" id="excessAmountItem" style="display: none;">
                    <span class="breakdown-label">ê³¼ì„¸ ëŒ€ìƒ ê¸ˆì•¡ (12ì–µ ì´ˆê³¼ë¶„)</span>
                    <span class="breakdown-value" id="excessAmount">0ì›</span>
                </div>
            </div>

            <div class="result-info" id="mainInfo">
                <div class="info-icon">â„¹ï¸</div>
                <div class="info-text" id="resultInfo"></div>
            </div>

            <div class="result-info" style="background: rgba(255, 87, 51, 0.05); border-color: rgba(255, 87, 51, 0.2);" id="warningBox" style="display: none;">
                <div class="info-icon">âš ï¸</div>
                <div class="info-text" id="warningText"></div>
            </div>

            <div class="result-info" style="background: rgba(0, 217, 181, 0.05); border-color: rgba(0, 217, 181, 0.2);">
                <div class="info-icon">ğŸ’¡</div>
                <div class="info-text">
                    <strong>ë¹„ê³¼ì„¸ í™œìš© íŒ</strong><br>
                    â€¢ ë³´ìœ Â·ê±°ì£¼ê¸°ê°„ì€ í•˜ë£¨ë¼ë„ ì°¨ì´ë‚˜ë©´ ë¹„ê³¼ì„¸ ë¶ˆê°€ëŠ¥<br>
                    â€¢ 2ë…„ ì¶©ì¡± ì§ì „ ë§¤ë„ëŠ” í”¼í•˜ê³  ì—¬ìœ ìˆê²Œ ê³„íš<br>
                    â€¢ ì¡°ì •ì§€ì—­ì€ 2ë…„â†’3ë…„ìœ¼ë¡œ ê°•í™”ë  ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜<br>
                    â€¢ 12ì–µ ì´ˆê³¼ë¶„ì€ ì–‘ë„ì„¸ ë¶€ê³¼ë˜ë¯€ë¡œ ê°€ê²© í˜‘ìƒ ì‹œ ê³ ë ¤
                </div>
            </div>

            <div class="result-actions">
                <button class="action-button secondary" id="resetButton">
                    ë‹¤ì‹œ í™•ì¸í•˜ê¸°
                </button>
                <button class="action-button primary" id="shareButton">
                    ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </main>

    <script>
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transferDate').value = today;

            const calculateButton = document.getElementById('calculateButton');
            if (calculateButton) {
                calculateButton.addEventListener('click', checkExemption);
            }

            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', resetCalculator);
            }

            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', shareResult);
            }

            // ìˆ«ì ì…ë ¥ í•„ë“œ
            const transferPriceInput = document.getElementById('transferPrice');
            if (transferPriceInput) {
                transferPriceInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    e.target.value = value;
                });
                transferPriceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') checkExemption();
                });
            }
        });

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.floor(num));
        }

        function formatCurrency(num) {
            return formatNumber(num) + 'ì›';
        }

        function formatKoreanCurrency(num) {
            const billion = Math.floor(num / 100000000);
            const tenThousand = Math.floor((num % 100000000) / 10000);
            const remainder = num % 10000;
            
            let result = '';
            if (billion > 0) result += billion + 'ì–µ ';
            if (tenThousand > 0) result += formatNumber(tenThousand) + 'ë§Œ ';
            if (remainder > 0 && billion === 0) result += formatNumber(remainder);
            
            return result.trim() + 'ì›';
        }

        function calculatePeriod(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            const diffTime = end - start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            const days = diffDays % 30;
            
            return {
                years: years,
                months: months,
                days: days,
                totalDays: diffDays,
                totalYears: diffDays / 365
            };
        }

        function checkExemption() {
            const acquisitionDate = document.getElementById('acquisitionDate').value;
            const transferDate = document.getElementById('transferDate').value;
            const residenceStartDate = document.getElementById('residenceStartDate').value;
            let residenceEndDate = document.getElementById('residenceEndDate').value;
            
            if (!acquisitionDate || !transferDate || !residenceStartDate) {
                alert('ì·¨ë“ì¼, ì–‘ë„ì¼, ê±°ì£¼ ì‹œì‘ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ê±°ì£¼ ì¢…ë£Œì¼ì´ ì—†ìœ¼ë©´ ì–‘ë„ì¼ë¡œ ì„¤ì •
            if (!residenceEndDate) {
                residenceEndDate = transferDate;
            }

            const housingCount = document.querySelector('input[name="housingCount"]:checked').value;
            const location = document.querySelector('input[name="location"]:checked').value;
            const transferPrice = parseInt(document.getElementById('transferPrice').value) || 0;
            const household = document.querySelector('input[name="household"]:checked').value;
            const otherHousing = document.querySelector('input[name="otherHousing"]:checked').value;

            // ê¸°ê°„ ê³„ì‚°
            const holdingPeriod = calculatePeriod(acquisitionDate, transferDate);
            const residencePeriod = calculatePeriod(residenceStartDate, residenceEndDate);

            // ìš”ê±´ ì²´í¬
            const isHouseholdOk = household === 'single' && otherHousing === 'no';
            const isHousingOk = housingCount === '1';
            const isHoldingOk = holdingPeriod.totalYears >= 2;
            
            // ê±°ì£¼ê¸°ê°„ ìš”ê±´ (2021ë…„ ì´í›„ ì·¨ë“ë¶„ì€ 2ë…„ ì´ìƒ í•„ìš”)
            const acquisitionYear = new Date(acquisitionDate).getFullYear();
            let residenceRequired = acquisitionYear >= 2021;
            let isResidenceOk = true;
            if (residenceRequired) {
                isResidenceOk = residencePeriod.totalYears >= 2;
            }

            // ì¡°ì •ì§€ì—­ ì¶”ê°€ ìš”ê±´ (í•„ìš”ì‹œ)
            // í˜„ì¬ëŠ” ì¼ë°˜ ìš”ê±´ë§Œ ì²´í¬

            // ë¹„ê³¼ì„¸ í•œë„
            const exemptionLimit = 1200000000; // 12ì–µ
            const isPriceOk = transferPrice <= exemptionLimit;

            // ì „ì²´ ìš”ê±´ ì¶©ì¡± ì—¬ë¶€
            const isFullyExempt = isHouseholdOk && isHousingOk && isHoldingOk && isResidenceOk && isPriceOk;

            // ë¶€ë¶„ ë¹„ê³¼ì„¸ (12ì–µ ì´ˆê³¼)
            const isPartialExempt = isHouseholdOk && isHousingOk && isHoldingOk && isResidenceOk && transferPrice > exemptionLimit;

            // ê²°ê³¼ ì¹´ë“œ ìƒ‰ìƒ
            const resultCard = document.getElementById('resultCard');
            if (isFullyExempt) {
                resultCard.style.background = 'linear-gradient(135deg, #00D9B5 0%, #00B894 100%)';
                document.getElementById('exemptionStatus').textContent = 'âœ“ ì™„ì „ ë¹„ê³¼ì„¸';
            } else if (isPartialExempt) {
                resultCard.style.background = 'linear-gradient(135deg, #FFB800 0%, #FFA000 100%)';
                document.getElementById('exemptionStatus').textContent = 'â–³ ë¶€ë¶„ ë¹„ê³¼ì„¸';
            } else {
                resultCard.style.background = 'linear-gradient(135deg, #FF5733 0%, #C70039 100%)';
                document.getElementById('exemptionStatus').textContent = 'âœ— ê³¼ì„¸ ëŒ€ìƒ';
            }

            // ê°œë³„ ìš”ê±´ ê²°ê³¼
            document.getElementById('householdResult').textContent = isHouseholdOk ? 'âœ“ ì¶©ì¡±' : 'âœ— ë¯¸ì¶©ì¡±';
            document.getElementById('householdResult').style.color = isHouseholdOk ? 'var(--secondary)' : '#FF5733';

            document.getElementById('housingResult').textContent = isHousingOk ? 'âœ“ ì¶©ì¡±' : 'âœ— ë¯¸ì¶©ì¡±';
            document.getElementById('housingResult').style.color = isHousingOk ? 'var(--secondary)' : '#FF5733';

            document.getElementById('holdingResult').textContent = isHoldingOk ? 
                `âœ“ ì¶©ì¡± (${holdingPeriod.years}ë…„ ${holdingPeriod.months}ê°œì›”)` : 
                `âœ— ë¯¸ì¶©ì¡± (${holdingPeriod.years}ë…„ ${holdingPeriod.months}ê°œì›”)`;
            document.getElementById('holdingResult').style.color = isHoldingOk ? 'var(--secondary)' : '#FF5733';

            if (residenceRequired) {
                document.getElementById('residenceResult').textContent = isResidenceOk ? 
                    `âœ“ ì¶©ì¡± (${residencePeriod.years}ë…„ ${residencePeriod.months}ê°œì›”)` : 
                    `âœ— ë¯¸ì¶©ì¡± (${residencePeriod.years}ë…„ ${residencePeriod.months}ê°œì›”)`;
                document.getElementById('residenceResult').style.color = isResidenceOk ? 'var(--secondary)' : '#FF5733';
            } else {
                document.getElementById('residenceResult').textContent = 'í•´ë‹¹ ì—†ìŒ (2021ë…„ ì´ì „ ì·¨ë“)';
                document.getElementById('residenceResult').style.color = 'var(--text-secondary)';
            }

            document.getElementById('priceResult').textContent = isPriceOk ? 
                'âœ“ í•œë„ ë‚´' : 
                `â–³ í•œë„ ì´ˆê³¼ (${formatKoreanCurrency(transferPrice - exemptionLimit)} ê³¼ì„¸)`;
            document.getElementById('priceResult').style.color = isPriceOk ? 'var(--secondary)' : '#FFB800';

            // ê¸°ê°„ ìƒì„¸
            document.getElementById('holdingPeriod').textContent = 
                `${holdingPeriod.years}ë…„ ${holdingPeriod.months}ê°œì›” ${holdingPeriod.days}ì¼`;
            document.getElementById('residencePeriod').textContent = 
                `${residencePeriod.years}ë…„ ${residencePeriod.months}ê°œì›” ${residencePeriod.days}ì¼`;
            document.getElementById('displayAcquisitionDate').textContent = acquisitionDate;
            document.getElementById('displayTransferDate').textContent = transferDate;

            // ë¹„ê³¼ì„¸ ê¸ˆì•¡ ê³„ì‚°
            if (transferPrice > 0) {
                document.getElementById('taxSection').style.display = 'block';
                document.getElementById('displayTransferPrice').textContent = formatCurrency(transferPrice);
                
                if (isFullyExempt) {
                    document.getElementById('exemptionAmount').textContent = formatCurrency(transferPrice);
                    document.getElementById('excessAmountItem').style.display = 'none';
                } else if (isPartialExempt) {
                    document.getElementById('exemptionAmount').textContent = formatCurrency(exemptionLimit);
                    document.getElementById('excessAmountItem').style.display = 'flex';
                    document.getElementById('excessAmount').textContent = formatCurrency(transferPrice - exemptionLimit);
                } else {
                    document.getElementById('exemptionAmount').textContent = '0ì›';
                    document.getElementById('excessAmountItem').style.display = 'flex';
                    document.getElementById('excessAmount').textContent = formatCurrency(transferPrice);
                }
            } else {
                document.getElementById('taxSection').style.display = 'none';
            }

            // ì•ˆë‚´ ë©”ì‹œì§€
            let resultInfo = '';
            let warningText = '';

            if (isFullyExempt) {
                resultInfo = 'ëª¨ë“  ìš”ê±´ì„ ì¶©ì¡±í•˜ì—¬ ì–‘ë„ì†Œë“ì„¸ê°€ ì™„ì „ ë¹„ê³¼ì„¸ë©ë‹ˆë‹¤. ì–‘ë„ê°€ì•¡ ì „ì•¡ì´ ë¹„ê³¼ì„¸ ëŒ€ìƒì…ë‹ˆë‹¤.';
            } else if (isPartialExempt) {
                resultInfo = `ê¸°ë³¸ ìš”ê±´ì€ ì¶©ì¡±í•˜ë‚˜ ì–‘ë„ê°€ì•¡ì´ 12ì–µì›ì„ ì´ˆê³¼í•©ë‹ˆë‹¤. 12ì–µì›ê¹Œì§€ëŠ” ë¹„ê³¼ì„¸ë˜ê³ , ì´ˆê³¼ë¶„ ${formatKoreanCurrency(transferPrice - exemptionLimit)}ì— ëŒ€í•´ì„œë§Œ ì–‘ë„ì„¸ê°€ ë¶€ê³¼ë©ë‹ˆë‹¤.`;
            } else {
                resultInfo = 'ë¹„ê³¼ì„¸ ìš”ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í•˜ì—¬ ì–‘ë„ì†Œë“ì„¸ê°€ ë¶€ê³¼ë©ë‹ˆë‹¤.';
                
                // ë¯¸ì¶©ì¡± í•­ëª© ì•ˆë‚´
                const failures = [];
                if (!isHouseholdOk) failures.push('1ì„¸ëŒ€ ìš”ê±´');
                if (!isHousingOk) failures.push('1ì£¼íƒ ìš”ê±´');
                if (!isHoldingOk) failures.push('ë³´ìœ ê¸°ê°„ 2ë…„');
                if (residenceRequired && !isResidenceOk) failures.push('ê±°ì£¼ê¸°ê°„ 2ë…„');
                
                if (failures.length > 0) {
                    warningText = `ë¯¸ì¶©ì¡± í•­ëª©: ${failures.join(', ')}. í•´ë‹¹ ìš”ê±´ì„ ì¶©ì¡±í•´ì•¼ ë¹„ê³¼ì„¸ ì ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
                }

                // ë¶€ì¡±í•œ ê¸°ê°„ ì•ˆë‚´
                if (!isHoldingOk) {
                    const daysNeeded = Math.ceil((2 * 365) - holdingPeriod.totalDays);
                    warningText += ` ë³´ìœ ê¸°ê°„ì´ ì•½ ${Math.ceil(daysNeeded / 30)}ê°œì›” ë¶€ì¡±í•©ë‹ˆë‹¤.`;
                }
                if (residenceRequired && !isResidenceOk) {
                    const daysNeeded = Math.ceil((2 * 365) - residencePeriod.totalDays);
                    warningText += ` ê±°ì£¼ê¸°ê°„ì´ ì•½ ${Math.ceil(daysNeeded / 30)}ê°œì›” ë¶€ì¡±í•©ë‹ˆë‹¤.`;
                }
            }

            document.getElementById('resultInfo').textContent = resultInfo;

            const warningBox = document.getElementById('warningBox');
            if (warningText) {
                warningBox.style.display = 'block';
                document.getElementById('warningText').textContent = warningText;
            } else {
                warningBox.style.display = 'none';
            }

            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetCalculator() {
            document.getElementById('acquisitionDate').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transferDate').value = today;
            document.getElementById('residenceStartDate').value = '';
            document.getElementById('residenceEndDate').value = '';
            document.getElementById('transferPrice').value = '';
            document.querySelector('input[name="housingCount"][value="1"]').checked = true;
            document.querySelector('input[name="location"][value="general"]').checked = true;
            document.querySelector('input[name="household"][value="single"]').checked = true;
            document.querySelector('input[name="otherHousing"][value="no"]').checked = true;
            document.getElementById('resultSection').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareResult() {
            const status = document.getElementById('exemptionStatus').textContent;
            const holdingPeriod = document.getElementById('holdingPeriod').textContent;
            const residencePeriod = document.getElementById('residencePeriod').textContent;
            const text = `ë¶€ë™ì‚°ê³„ì‚°í•˜ê¸°ì—ì„œ 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ë¥¼ í™•ì¸í–ˆì–´ìš”!\nê²°ê³¼: ${status}\në³´ìœ ê¸°ê°„: ${holdingPeriod}\nê±°ì£¼ê¸°ê°„: ${residencePeriod}`;
            
            if (navigator.share) {
                navigator.share({
                    title: '1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ í™•ì¸ ê²°ê³¼',
                    text: text
                });
            } else {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                navigator.clipboard.writeText(text);
            }
        }
    </script>
</body>
</html>
